# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ –∞–∫—Ç–∏–≤–æ–≤

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ –∞–∫—Ç–∏–≤–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–î–∏–Ω–∞–º–∏–∫–∞ —Ü–µ–Ω –Ω–∞ –Ω–µ—Ñ—Ç—å –∏ –∑–æ–ª–æ—Ç–æ") –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:

```
**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–æ–≤**

**–ê–∫—Ç–∏–≤—ã:** GC.COMM, BRENT.COMM
**–í–∞–ª—é—Ç–∞:** USD
**–ü–µ—Ä–∏–æ–¥:** 5Y

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:** –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
```

## üîç –ü—Ä–∏—á–∏–Ω–∞

1. **–û—à–∏–±–∫–∏ –≤ `_create_metrics_table`**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `None` –∑–Ω–∞—á–µ–Ω–∏–π –∏ –æ—à–∏–±–æ–∫ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏**: –ù–µ –±—ã–ª–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –∏ –≥–¥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –æ—à–∏–±–∫–∏
3. **–ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–æ–≤–∞—Ä–Ω—ã–º–∏ –∞–∫—Ç–∏–≤–∞–º–∏**: GC.COMM –∏ BRENT.COMM –º–æ–≥–ª–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ fallback**: –ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏, –Ω–µ –±—ã–ª–æ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Å–ø–æ—Å–æ–±–∞ –ø–æ–∫–∞–∑–∞—Ç—å –¥–∞–Ω–Ω—ã–µ

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –£–ª—É—á—à–µ–Ω `_create_metrics_table` –≤ `report_builder_enhanced.py`

**–î–æ–±–∞–≤–ª–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π:**
```python
# –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç–∏–ø–æ–≤
cagr = metric_data.get('cagr')
volatility = metric_data.get('volatility')
sharpe = metric_data.get('sharpe')
max_drawdown = metric_data.get('max_drawdown')
total_return = metric_data.get('total_return')

# –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ None
'CAGR (%)': f"{cagr*100:.2f}" if cagr is not None else "N/A"
```

**–î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ fallback:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –º–µ—Ç—Ä–∏–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- Fallback –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å–æ–∑–¥–∞–Ω–∏—è DataFrame
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ "–û–±—â–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (%)"

### 2. –£–ª—É—á—à–µ–Ω `_build_comparison_report` –≤ `report_builder_enhanced.py`

**–î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**
```python
# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö
logger.info(f"Building comparison report for tickers: {tickers}")
logger.info(f"Metrics keys: {list(metrics.keys()) if metrics else 'No metrics'}")
logger.info(f"Metrics structure: {metrics}")
logger.info(f"Prices shape: {prices.shape if hasattr(prices, 'shape') else 'No prices'}")
```

**–î–æ–±–∞–≤–ª–µ–Ω fallback –¥–ª—è –º–µ—Ç—Ä–∏–∫:**
- –ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–æ—Å—Ç—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ —Ü–µ–Ω
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–µ—Ç—Ä–∏–∫
- –ü–æ–ø—ã—Ç–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –±–∞–∑–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π (–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å, –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å)

### 3. –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `_compute_simple_metrics`

**–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ –∏–∑ —Ü–µ–Ω:**
```python
def _compute_simple_metrics(self, prices: pd.Series) -> Dict[str, Any]:
    # –û–±—â–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
    total_return = (prices.iloc[-1] / prices.iloc[0]) - 1.0
    
    # –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (–≥–æ–¥–æ–≤–∞—è)
    returns = prices.pct_change().dropna()
    volatility = float(np.std(returns, ddof=1)) * np.sqrt(periods_per_year)
    
    return {'total_return': total_return, 'volatility': volatility}
```

### 4. –£–ª—É—á—à–µ–Ω `_handle_asset_comparison` –≤ `okama_handler_enhanced.py`

**–î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```python
logger.info(f"Aligned data shape: {aligned_data.shape}")
logger.info(f"Aligned data columns: {list(aligned_data.columns)}")
logger.info(f"Returns data shape: {returns_data.shape}")
logger.info(f"Computing metrics for {asset}, prices length: {len(asset_prices)}")
logger.info(f"Metrics for {asset}: {asset_metrics}")
```

**–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- Try-catch –±–ª–æ–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–∫—Ç–∏–≤–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ–º –º–µ—Ç—Ä–∏–∫
- –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∞–∫—Ç–∏–≤–æ–≤

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–æ–≤:

‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏:**
- CAGR, –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, Sharpe Ratio
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞, –û–±—â–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π

‚úÖ **–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

‚úÖ **–ò–º–µ–µ—Ç fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã:**
- –ü—Ä–æ—Å—Ç—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ —Ü–µ–Ω –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö
- –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
- –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏ —á–∞—Å—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö

‚úÖ **–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–Ω—ã—Ö –∞–∫—Ç–∏–≤–æ–≤:**
- GC.COMM (–∑–æ–ª–æ—Ç–æ), BRENT.COMM (–Ω–µ—Ñ—Ç—å)
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∞–∫—Ç–∏–≤–æ–≤

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

**–ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–µ—Ç—Ä–∏–∫:**
1. `okama_handler._handle_asset_comparison` ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
2. `report_builder._build_comparison_report` ‚Üí –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
3. `_create_metrics_table` ‚Üí –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –º–µ—Ç—Ä–∏–∫
4. Fallback ‚Üí –ø—Ä–æ—Å—Ç—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ —Ü–µ–Ω –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ—Ç—Ä–∏–∫:**
```python
{
    'GC.COMM': {
        'cagr': 0.0856,
        'volatility': 0.2341,
        'sharpe': 0.366,
        'max_drawdown': -0.1567,
        'total_return': 0.4567
    },
    'BRENT.COMM': {
        'cagr': 0.0234,
        'volatility': 0.3456,
        'sharpe': 0.0678,
        'max_drawdown': -0.2345,
        'total_return': 0.1234
    }
}
```

–¢–µ–ø–µ—Ä—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Å –∫—Ä–∞—Å–∏–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º!
