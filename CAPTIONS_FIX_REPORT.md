# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ–ø–∏—Å–∞–Ω–∏–π –≥—Ä–∞—Ñ–∏–∫–æ–≤

## –î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2025-08-31

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª –æ –¥–≤—É—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö:
1. –í –æ–ø–∏—Å–∞–Ω–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞ drawdowns –Ω–µ—Ç —Å–∞–º—ã—Ö –±–æ–ª—å—à–∏—Ö –ø—Ä–æ—Å–∞–¥–æ–∫ –∏ –ø–µ—Ä–∏–æ–¥–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
2. –í –æ–ø–∏—Å–∞–Ω–∏–∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –Ω–µ—Ç CAGR

## üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### 1. –ü—Ä–æ–±–ª–µ–º–∞ —Å CAGR

**–ü—Ä–æ–±–ª–µ–º–∞**: `TypeError: unsupported format string passed to Series.__format__`

**–ü—Ä–∏—á–∏–Ω–∞**: –ú–µ—Ç–æ–¥ `portfolio.get_cagr()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç pandas Series –≤–º–µ—Å—Ç–æ —Å–∫–∞–ª—è—Ä–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ Series –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å–∫–∞–ª—è—Ä–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è:

```python
# Handle CAGR which might be a Series
if hasattr(cagr, '__iter__') and not isinstance(cagr, str):
    # If it's a Series or array-like, get the first value
    if hasattr(cagr, 'iloc'):
        cagr_value = cagr.iloc[0]
    elif hasattr(cagr, '__getitem__'):
        cagr_value = cagr[0]
    else:
        cagr_value = list(cagr)[0]
else:
    cagr_value = cagr
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä–æ—Å–∞–¥–æ–∫

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Å–∞–¥–æ–∫ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∞–ª–æ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
- ‚úÖ 5 —Å–∞–º—ã—Ö –±–æ–ª—å—à–∏—Ö –ø—Ä–æ—Å–∞–¥–æ–∫
- ‚úÖ –°–∞–º—ã–µ –¥–æ–ª–≥–∏–µ –ø–µ—Ä–∏–æ–¥—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤ –≥–æ–¥–∞—Ö

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –§–∞–π–ª: `bot.py`
**–ú–µ—Ç–æ–¥**: `_create_portfolio_returns_chart`
**–°—Ç—Ä–æ–∫–∏**: 3010-3020

**–î–æ–±–∞–≤–ª–µ–Ω–æ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ CAGR –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è.

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –û–ø–∏—Å–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–æ—Å–∞–¥–æ–∫:
```
üìâ –ü—Ä–æ—Å–∞–¥–∫–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è: LQDT.MOEX, OBLG.MOEX, GOLD.MOEX

üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
‚Ä¢ –í–∞–ª—é—Ç–∞: RUB
‚Ä¢ –í–µ—Å–∞: 78.0%, 16.0%, 6.0%

üìâ 5 —Å–∞–º—ã—Ö –±–æ–ª—å—à–∏—Ö –ø—Ä–æ—Å–∞–¥–æ–∫:
1. 2021-02-28: -0.30%
2. 2022-09-30: -0.26%
3. 2022-02-28: -0.25%
4. 2020-11-30: -0.22%
5. 2021-03-31: -0.16%

‚è±Ô∏è –°–∞–º—ã–µ –¥–æ–ª–≥–∏–µ –ø–µ—Ä–∏–æ–¥—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:
1. 2021-03-31: 0.2 –ª–µ—Ç
2. 2020-11-30: 0.1 –ª–µ—Ç
3. 2021-06-30: 0.1 –ª–µ—Ç
4. 2022-02-28: 0.1 –ª–µ—Ç
5. 2022-09-30: 0.1 –ª–µ—Ç
```

### –û–ø–∏—Å–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏:
```
üí∞ –ì–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—è: LQDT.MOEX, OBLG.MOEX, GOLD.MOEX

üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
‚Ä¢ –í–∞–ª—é—Ç–∞: RUB
‚Ä¢ –í–µ—Å–∞: 78.0%, 16.0%, 6.0%

üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏:
‚Ä¢ –°—Ä–µ–¥–Ω—è—è –º–µ—Å—è—á–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: 0.88%
‚Ä¢ –°—Ä–µ–¥–Ω—è—è –≥–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: 11.13%
‚Ä¢ CAGR (Compound Annual Growth Rate): 11.10%
```

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ü–†–û–ë–õ–ï–ú–´ –†–ï–®–ï–ù–´** ‚úÖ

- ‚úÖ CAGR —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Å–∞–¥–æ–∫ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∞–ª–∞ –≤—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- ‚úÖ –í—Å–µ –æ–ø–∏—Å–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ Series –æ–±—ä–µ–∫—Ç–æ–≤:
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞**: `hasattr(obj, '__iter__') and not isinstance(obj, str)`
- **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è**: `obj.iloc[0]` –¥–ª—è pandas Series
- **Fallback**: `obj[0]` –¥–ª—è –¥—Ä—É–≥–∏—Ö –∏—Ç–µ—Ä–∏—Ä—É–µ–º—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- **–ü—Ä–æ—Å–∞–¥–∫–∏**: `portfolio.drawdowns.nsmallest(5)`
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: `portfolio.recovery_period.nlargest(5) / 12`
- **–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å**: `portfolio.mean_return_monthly`, `portfolio.mean_return_annual`
- **CAGR**: `portfolio.get_cagr()` —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π Series
