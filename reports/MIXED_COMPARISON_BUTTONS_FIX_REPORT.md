# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ —Å–º–µ—à–∞–Ω–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

## –î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2025-01-27

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –û—à–∏–±–∫–∞ "Unknown datetime string format, unable to parse: portfolio_1626.PF"
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Å–º–µ—à–∞–Ω–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (Drawdowns, Dividends, Correlation) –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –æ—à–∏–±–∫–∏:
```
‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞ –¥–∏–≤–∏–¥–µ–Ω–¥–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏: Unknown datetime string format, unable to parse: portfolio_1626.PF, at position 0
‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–æ—Å–∞–¥–æ–∫: [Errno portfolio_9433.PF is not found in the database.] 404
‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –º–∞—Ç—Ä–∏—Ü—ã: [Errno portfolio_9433.PF is not found in the database.] 404
```

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Å–æ–∑–¥–∞–Ω–∏—é `ok.AssetList` —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ `ok.Portfolio`.

**–î–µ—Ç–∞–ª–∏**:
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ú–µ—Ç–æ–¥—ã —Å–º–µ—à–∞–Ω–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø—ã—Ç–∞–ª–∏—Å—å —Å–æ–∑–¥–∞—Ç—å `ok.AssetList(asset_list_items)`, –≥–¥–µ `asset_list_items` —Å–æ–¥–µ—Ä–∂–∞–ª –æ–±—ä–µ–∫—Ç—ã `ok.Portfolio`
- **–†–µ–∞–ª—å–Ω–æ—Å—Ç—å**: Okama –ø—ã—Ç–∞–µ—Ç—Å—è –ø–∞—Ä—Å–∏—Ç—å —Å–∏–º–≤–æ–ª—ã –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `portfolio_1626.PF`) –∫–∞–∫ datetime string –∏–ª–∏ –∏—Å–∫–∞—Ç—å –∏—Ö –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–æ–≤
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ datetime –∏ "not found in database"

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ `_create_mixed_comparison_dividends_chart`

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
```python
# Create AssetList for mixed comparison
mixed_asset_list = ok.AssetList(asset_list_items)  # ‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
```python
# Process portfolios separately to avoid AssetList creation issues
for i, portfolio_context in enumerate(portfolio_contexts):
    # Create separate AssetList for portfolio assets
    portfolio_asset_list = self._ok_asset_list(assets, currency=currency)
    # Calculate weighted dividend yield manually
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ `_create_mixed_comparison_drawdowns_chart`

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
```python
# Create AssetList for mixed comparison
mixed_asset_list = ok.AssetList(asset_list_items)  # ‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
```python
# Process portfolios separately to avoid AssetList creation issues
for i, portfolio_context in enumerate(portfolio_contexts):
    # Create portfolio using ok.Portfolio
    portfolio = ok.Portfolio(assets, weights, ...)
    # Calculate drawdowns directly from portfolio.wealth_index
```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ `_create_mixed_comparison_correlation_matrix`

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
```python
# Create AssetList for mixed comparison
mixed_asset_list = ok.AssetList(asset_list_items)  # ‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
```python
# Process portfolios separately to avoid AssetList creation issues
for i, portfolio_context in enumerate(portfolio_contexts):
    # Create portfolio using ok.Portfolio
    portfolio = ok.Portfolio(assets, weights, ...)
    # Calculate returns directly from portfolio.wealth_index
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
1. **–†–∞–∑–¥–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –ü–æ—Ä—Ç—Ñ–µ–ª–∏ –∏ –∞–∫—Ç–∏–≤—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
2. **–ü—Ä—è–º–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `ok.Portfolio` –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞—á–∏ –≤ `ok.AssetList`
3. **–†—É—á–Ω–æ–π —Ä–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫**: –î–∏–≤–∏–¥–µ–Ω–¥–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å, –ø—Ä–æ—Å–∞–¥–∫–∏ –∏ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é
4. **–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ –µ–¥–∏–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- **–ü–æ—Ä—Ç—Ñ–µ–ª–∏**: –°–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `ok.Portfolio`, –º–µ—Ç—Ä–∏–∫–∏ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é
- **–ê–∫—Ç–∏–≤—ã**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `ok.AssetList` –∫–∞–∫ –æ–±—ã—á–Ω–æ
- **–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ**: –î–∞–Ω–Ω—ã–µ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ pandas DataFrame –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤

### –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ö–∞–∂–¥—ã–π —à–∞–≥ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- **Graceful fallback**: –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç–µ—Å—Ç—ã
1. **–°–º–µ—à–∞–Ω–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ**: `/compare PORTFOLIO_1 SPY.US`
2. **–ö–Ω–æ–ø–∫–∞ Drawdowns**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–æ—Å–∞–¥–æ–∫
3. **–ö–Ω–æ–ø–∫–∞ Dividends**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –¥–∏–≤–∏–¥–µ–Ω–¥–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
4. **–ö–Ω–æ–ø–∫–∞ Correlation**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –º–∞—Ç—Ä–∏—Ü—ã
5. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- ‚úÖ –ì—Ä–∞—Ñ–∏–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ datetime
- ‚úÖ –ü–æ—Ä—Ç—Ñ–µ–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–∞—Å—á–µ—Ç –≤–∑–≤–µ—à–µ–Ω–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ caption —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Å–æ—Å—Ç–∞–≤–∞

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- **`bot.py`**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã —Å–º–µ—à–∞–Ω–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
  - `_create_mixed_comparison_dividends_chart`
  - `_create_mixed_comparison_drawdowns_chart`
  - `_create_mixed_comparison_correlation_matrix`

### –£–ª—É—á—à–µ–Ω–∏—è
1. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞**: –ë–æ–ª—å—à–µ –Ω–µ—Ç –ø–æ–ø—ã—Ç–æ–∫ –ø–∞—Ä—Å–∏—Ç—å —Å–∏–º–≤–æ–ª—ã –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π –∫–∞–∫ datetime
2. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π**: –ü–æ—Ä—Ç—Ñ–µ–ª–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
4. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: Graceful handling –æ—à–∏–±–æ–∫ —Å fallback –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç:
1. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫** —Å–º–µ—à–∞–Ω–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
2. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ datetime** –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ø–æ—Ä—Ç—Ñ–µ–ª—è–º–∏
3. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫** –¥–ª—è –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π –∏ –∞–∫—Ç–∏–≤–æ–≤
4. **–£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç** —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ –≥—Ä–∞—Ñ–∏–∫–∞–º–∏

–ö–æ–º–∞–Ω–¥–∞ `/compare` —Å –ø–æ—Ä—Ç—Ñ–µ–ª—è–º–∏ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ, –∞ –≤—Å–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Å–æ–∑–¥–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –±–µ–∑ –æ—à–∏–±–æ–∫.
