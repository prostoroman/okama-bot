# COMPARISON_PERIODINDEX_FIX_REPORT

## Проблема
При выполнении команды `/compare` возникала ошибка:
```
float() argument must be a string or a real number, not 'Period'
```
Это происходило из‑за попытки отрисовать график с `PeriodIndex` (например, месячный индекс), когда ось X конвертировалась в числа без учёта Period.

## Изменение
- Добавлена безопасная обработка `PeriodIndex` в методе `create_comparison_chart` файла `services/chart_styles.py`.
- Теперь, если индекс данных — `PeriodIndex`, он конвертируется в метки времени (`Timestamp`) перед построением графика.

## Детали реализации
Файл: `services/chart_styles.py`
Изменён метод `create_comparison_chart`:
- Если у `data.index` тип начинается с `period`, выполняется `data.index = data.index.to_timestamp()`.
- При ошибке конвертации выполняется fallback: `pd.to_datetime` от строкового представления индекса.

## Результат
- Ошибка при сравнении активов с `PeriodIndex` устранена.
- Команда `/compare` корректно строит графики для данных с периодическим индексом (месяцы/кварталы/годы).

## Проверка
- Ручная проверка кода и соответствующих путей построения графиков в `bot.py` и `okama_handler_enhanced.py`.
- Код устойчив к наличию `Period` объектов в индексах и значениях дат.

## Примечания
- Похожие механизмы обработки `Period` уже присутствуют в `smooth_line_data` и других местах; изменение унифицирует поведение непосредственно в методе построения графика сравнения.