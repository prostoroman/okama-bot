# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–µ—Ä–∏–æ–¥–∞–º–∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª, —á—Ç–æ –≥—Ä–∞—Ñ–∏–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ –¥–ª—è –≤—Å–µ—Ö –ø–µ—Ä–∏–æ–¥–æ–≤ (1Y, 3Y, 5Y), —Ö–æ—Ç—è –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞.

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `get_daily_data_by_days` –≤ `TushareService`:

1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω–µ–π –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–µ –¥–Ω–∏**: –§—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ `timedelta(days=days)` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –Ω–∞—á–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã, –≥–¥–µ `days` - —ç—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω–µ–π (252 –¥–ª—è 1Y, 1260 –¥–ª—è 5Y).

2. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –±—É—Ñ–µ—Ä**: –ü–æ—Å–∫–æ–ª—å–∫—É —Ç–æ—Ä–≥–æ–≤—ã–µ –¥–Ω–∏ —Å–æ—Å—Ç–∞–≤–ª—è—é—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ 70% –æ—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π (–∏–∑-–∑–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö –∏ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤), –∑–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –∑–∞ 252 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω—è –¥–∞–≤–∞–ª —Ç–æ–ª—å–∫–æ ~176 —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω–µ–π –≤–º–µ—Å—Ç–æ —Ç—Ä–µ–±—É–µ–º—ã—Ö 252.

3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**: –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–µ –±—ã–ª–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ—á–Ω–æ –Ω—É–∂–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω–µ–π.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- **1Y –ø–µ—Ä–∏–æ–¥**: –¢—Ä–µ–±—É–µ—Ç—Å—è 252 —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω—è ‚âà 365 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π
- **5Y –ø–µ—Ä–∏–æ–¥**: –¢—Ä–µ–±—É–µ—Ç—Å—è 1260 —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω–µ–π ‚âà 1825 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `timedelta(days=252)` –¥–∞–≤–∞–ª–æ —Ç–æ–ª—å–∫–æ ~176 —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω–µ–π

## –†–µ—à–µ–Ω–∏–µ

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

**–§–∞–π–ª**: `services/tushare_service.py`
**–§—É–Ω–∫—Ü–∏—è**: `get_daily_data_by_days`

#### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```python
def get_daily_data_by_days(self, ts_code: str, days: int) -> pd.DataFrame:
    """Get daily price data for a symbol for specified number of days"""
    try:
        # Calculate start date based on days
        end_date = datetime.now().strftime('%Y%m%d')
        start_date = (datetime.now() - timedelta(days=days)).strftime('%Y%m%d')
        
        # Get data using the existing method
        return self.get_daily_data(ts_code, start_date, end_date)
```

#### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```python
def get_daily_data_by_days(self, ts_code: str, days: int) -> pd.DataFrame:
    """Get daily price data for a symbol for specified number of trading days"""
    try:
        # Calculate start date based on trading days
        # Convert trading days to calendar days with buffer
        # Assuming ~252 trading days per year, ~21 trading days per month
        # Add buffer to ensure we get enough data
        calendar_days_buffer = int(days * 1.4)  # 40% buffer for weekends and holidays
        
        end_date = datetime.now().strftime('%Y%m%d')
        start_date = (datetime.now() - timedelta(days=calendar_days_buffer)).strftime('%Y%m%d')
        
        # Get data using the existing method
        df = self.get_daily_data(ts_code, start_date, end_date)
        
        # Filter to get only the last 'days' trading days
        if not df.empty and len(df) > days:
            df = df.tail(days)
        
        return df
```

### –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ë—É—Ñ–µ—Ä –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π**: –î–æ–±–∞–≤–ª–µ–Ω 40% –±—É—Ñ–µ—Ä (`days * 1.4`) –¥–ª—è —É—á–µ—Ç–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö –∏ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤
2. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–æ—Ä–≥–æ–≤—ã–º –¥–Ω—è–º**: –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è `df.tail(days)` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ—á–Ω–æ –Ω—É–∂–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω–µ–π
3. **–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –§—É–Ω–∫—Ü–∏—è —Ç–µ–ø–µ—Ä—å —á–µ—Ç–∫–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ç–æ—Ä–≥–æ–≤—ã–º–∏ –¥–Ω—è–º–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç

**–§–∞–π–ª**: `tests/test_chart_period_fix.py`

–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
1. **–†–∞–∑–Ω—ã–µ –æ–±—ä–µ–º—ã –¥–∞–Ω–Ω—ã—Ö**: –ü–µ—Ä–∏–æ–¥ 5Y —Å–æ–¥–µ—Ä–∂–∏—Ç –±–æ–ª—å—à–µ –∑–∞–ø–∏—Å–µ–π, —á–µ–º –ø–µ—Ä–∏–æ–¥ 1Y
2. **–†–∞–∑–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –¥–∞—Ç**: –ü–µ—Ä–∏–æ–¥ 5Y –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ä–∞–Ω—å—à–µ, —á–µ–º –ø–µ—Ä–∏–æ–¥ 1Y
3. **–û–¥–∏–Ω–∞–∫–æ–≤–æ–µ –æ–∫–æ–Ω—á–∞–Ω–∏–µ**: –û–±–∞ –ø–µ—Ä–∏–æ–¥–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –≤ –æ–¥–Ω–æ –≤—Ä–µ–º—è (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ)
4. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ 1Y...
   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –∑–∞ 1Y: 234
   –ü–µ—Ä–≤–∞—è –¥–∞—Ç–∞: 2024-09-30 00:00:00
   –ü–æ—Å–ª–µ–¥–Ω—è—è –¥–∞—Ç–∞: 2025-09-15 00:00:00

üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ 5Y...
   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –∑–∞ 5Y: 1174
   –ü–µ—Ä–≤–∞—è –¥–∞—Ç–∞: 2020-11-17 00:00:00
   –ü–æ—Å–ª–µ–¥–Ω—è—è –¥–∞—Ç–∞: 2025-09-15 00:00:00

‚úÖ –ü–µ—Ä–∏–æ–¥ 5Y —Å–æ–¥–µ—Ä–∂–∏—Ç –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö, —á–µ–º –ø–µ—Ä–∏–æ–¥ 1Y
‚úÖ –ü–µ—Ä–∏–æ–¥ 5Y –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ä–∞–Ω—å—à–µ, —á–µ–º –ø–µ—Ä–∏–æ–¥ 1Y
‚úÖ –û–±–∞ –ø–µ—Ä–∏–æ–¥–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –≤ –æ–¥–Ω–æ –≤—Ä–µ–º—è (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ)
‚úÖ –ü–µ—Ä–∏–æ–¥ 5Y –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª—å—à–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç
```

## –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ (1Y, 3Y, 5Y) –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥–ª–∏ –≤–∏–¥–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫—É—é –¥–∏–Ω–∞–º–∏–∫—É –∑–∞ —Ä–∞–∑–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–∏–æ–¥–∞ –±—ã–ª–∞ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **1Y –≥—Ä–∞—Ñ–∏–∫–∏**: –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ ~252 —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω—è (~1 –≥–æ–¥)
- **5Y –≥—Ä–∞—Ñ–∏–∫–∏**: –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ ~1260 —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω–µ–π (~5 –ª–µ—Ç)
- **MAX –≥—Ä–∞—Ñ–∏–∫–∏**: –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—É—é –∏ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—É—é –¥–∏–Ω–∞–º–∏–∫—É

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ API –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã
- ‚úÖ –õ–æ–≥–∏–∫–∞ –≤ –±–æ—Ç–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –ø—Ä–µ–∂–¥–µ

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –≥—Ä–∞—Ñ–∏–∫–æ–≤ –¥–ª—è –≤—Å–µ—Ö –ø–µ—Ä–∏–æ–¥–æ–≤ —É—Å–ø–µ—à–Ω–æ —Ä–µ—à–µ–Ω–∞. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

1. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö** –ø–æ —Ç–æ—Ä–≥–æ–≤—ã–º –¥–Ω—è–º
2. **–†–∞–∑–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –¥–∞–Ω–Ω—ã—Ö** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤
3. **–°—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É** –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –±–æ—Ç–∞
4. **–£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç** –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤

–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

---
**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 2025-01-27  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: ‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ
