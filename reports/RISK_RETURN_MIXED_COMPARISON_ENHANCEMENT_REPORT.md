# –û—Ç—á–µ—Ç –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–Ω–æ–ø–∫–∏ Risk/Return –¥–ª—è —Å–º–µ—à–∞–Ω–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

## –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
2025-01-27

## –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –¶–µ–ª—å
–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É Risk/Return –≤ —Å–º–µ—à–∞–Ω–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ `/compare`, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç `ok.AssetList(["SP500TR.INDX", rf3, rf4]) .plot_assets(kind="cagr")` —Å –ø–æ—Ä—Ç—Ñ–µ–ª—è–º–∏, –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ–º—ã–º–∏ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ª–æ–≥–∏–∫–µ –ø–æ–∫–∞–∑–∞ –∫–Ω–æ–ø–∫–∏

**–î–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# Add Risk / Return for portfolio-only comparisons
if has_portfolios_only:
    keyboard.append([
        InlineKeyboardButton("üìä Risk / Return", callback_data="risk_return_compare")
    ])
```

**–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# Add Risk / Return for mixed comparisons (portfolios + assets)
if is_mixed_comparison:
    keyboard.append([
        InlineKeyboardButton("üìä Risk / Return", callback_data="risk_return_compare")
    ])
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –∫–Ω–æ–ø–∫–∏

**–û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
1. **–ò–∑–º–µ–Ω–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è**: –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ —Å–º–µ—à–∞–Ω–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ —Ç–æ–ª—å–∫–æ –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π
2. **–î–æ–±–∞–≤–ª–µ–Ω SP500TR.INDX**: –í AssetList —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç—Å—è `["SP500TR.INDX"] + portfolios`
3. **–û–±–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏**: –í—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞—é—Ç "SP500TR.INDX vs –ø–æ—Ä—Ç—Ñ–µ–ª–∏"
4. **–£–ª—É—á—à–µ–Ω fallback**: –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞—Å—á–µ—Ç CAGR –¥–ª—è SP500TR.INDX –≤ fallback —Ä–µ–∂–∏–º–µ

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**
```python
# Create AssetList with SP500TR.INDX and portfolios
asset_list_items = ["SP500TR.INDX"] + portfolios
asset_list = self._ok_asset_list(asset_list_items, currency=currency)

# okama plotting
asset_list.plot_assets(kind="cagr")
```

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏

### –ö–æ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞
- ‚úÖ –ü—Ä–∏ —Å–º–µ—à–∞–Ω–Ω–æ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏: `/compare PORTFOLIO_1 SPY.US`
- ‚úÖ –ü—Ä–∏ —Å–º–µ—à–∞–Ω–Ω–æ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏: `/compare PORTFOLIO_1 PORTFOLIO_2 SPY.US`
- ‚ùå –ü—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–æ–≤: `/compare SPY.US QQQ.US`
- ‚ùå –ü—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π: `/compare PORTFOLIO_1 PORTFOLIO_2`

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–Ω–æ–ø–∫–∞
1. **–°–æ–∑–¥–∞–µ—Ç AssetList** —Å `["SP500TR.INDX", portfolio1, portfolio2, ...]`
2. **–í—ã–ø–æ–ª–Ω—è–µ—Ç `plot_assets(kind="cagr")`** –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è CAGR
3. **–ü—Ä–∏–º–µ–Ω—è–µ—Ç —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—é** —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º "SP500TR.INDX vs –ø–æ—Ä—Ç—Ñ–µ–ª–∏"
4. **Fallback —Ä–µ–∂–∏–º** —Å–æ–∑–¥–∞–µ—Ç bar chart —Å —Ä—É—á–Ω—ã–º —Ä–∞—Å—á–µ—Ç–æ–º CAGR

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```
/compare PORTFOLIO_1 SPY.US
‚Üí –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "üìä Risk / Return"
‚Üí –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≥—Ä–∞—Ñ–∏–∫: SP500TR.INDX vs PORTFOLIO_1
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
```python
# Validate that this is a mixed comparison
if not expanded_symbols or not portfolio_contexts:
    await self._send_callback_message(update, context, 
        "‚ÑπÔ∏è –ö–Ω–æ–ø–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–º–µ—à–∞–Ω–Ω–æ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ (–ø–æ—Ä—Ç—Ñ–µ–ª–∏ + –∞–∫—Ç–∏–≤—ã)")
    return
```

### –°–æ–∑–¥–∞–Ω–∏–µ AssetList
```python
# Create list with SP500TR.INDX and portfolios
asset_list_items = ["SP500TR.INDX"] + portfolios
asset_list = self._ok_asset_list(asset_list_items, currency=currency)
```

### Fallback –¥–ª—è SP500TR.INDX
```python
# Add SP500TR.INDX CAGR
try:
    sp500 = self._ok_asset("SP500TR.INDX")
    sp500_cagr = sp500.get_cagr()
    # ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ CAGR
    cagr_values["SP500TR.INDX"] = sp500_val
except Exception as e:
    self.logger.warning(f"Failed to get SP500TR.INDX CAGR: {e}")
    cagr_values["SP500TR.INDX"] = 0.0
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ü–µ–ª–∏
1. **–ö–Ω–æ–ø–∫–∞ Risk/Return** —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–∞ –ø—Ä–∏ —Å–º–µ—à–∞–Ω–Ω–æ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏
2. **SP500TR.INDX** –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. **–ü–æ—Ä—Ç—Ñ–µ–ª–∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—Ç—Å—è** –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. **–ì—Ä–∞—Ñ–∏–∫ CAGR** —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `ok.AssetList(...).plot_assets(kind="cagr")`
5. **Fallback —Ä–µ–∂–∏–º** —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### üéØ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç
- –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ: –∫–Ω–æ–ø–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ –æ–Ω–∞ –Ω—É–∂–Ω–∞
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –ö—Ä–∞—Å–∏–≤—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
- –ù–∞–¥–µ–∂–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤ fallback —Ä–µ–∂–∏–º–µ

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
1. **–°–º–µ—à–∞–Ω–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ**: `/compare PF_1 SPY.US`
   - ‚úÖ –ö–Ω–æ–ø–∫–∞ Risk/Return –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
   - ‚úÖ –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≥—Ä–∞—Ñ–∏–∫ SP500TR.INDX vs PF_1

2. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–æ–≤**: `/compare SPY.US QQQ.US`
   - ‚ùå –ö–Ω–æ–ø–∫–∞ Risk/Return –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è

3. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π**: `/compare PF_1 PF_2`
   - ‚ùå –ö–Ω–æ–ø–∫–∞ Risk/Return –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ AssetList —Å SP500TR.INDX –∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è–º–∏
- ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ `plot_assets(kind="cagr")`
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ Fallback —Ä–µ–∂–∏–º –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –ø–æ–¥–ø–∏—Å–∏
