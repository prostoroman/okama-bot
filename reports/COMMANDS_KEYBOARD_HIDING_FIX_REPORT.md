# –û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–∫—Ä—ã—Ç–∏—è Reply Keyboard –≤ –∫–æ–º–∞–Ω–¥–∞—Ö –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑–∞–ª, —á—Ç–æ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –∫–æ–º–∞–Ω–¥–µ –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ `/info`, `/compare`, `/portfolio`, `/help` –ª—é–±–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è reply keyboard –¥–æ–ª–∂–Ω–∞ —Å–∫—Ä—ã–≤–∞—Ç—å—Å—è.

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
1. **`/start`** - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ—Ç reply keyboard
2. **`/help`** - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ—Ç reply keyboard  
3. **`/info`** - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ—Ç reply keyboard
4. **`/list`** (namespace_command) - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ—Ç reply keyboard
5. **`/search`** - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ—Ç reply keyboard
6. **`/compare`** - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ—Ç reply keyboard
7. **`/portfolio`** - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ—Ç reply keyboard
8. **`/test`** - ‚ùå –ù–ï —Å–∫—Ä—ã–≤–∞–ª reply keyboard (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

### –õ–æ–≥–∏–∫–∞ —Å–∫—Ä—ã—Ç–∏—è keyboard:

–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ñ—É–Ω–∫—Ü–∏—é `_ensure_no_reply_keyboard()` –≤ –Ω–∞—á–∞–ª–µ:

```python
async def _ensure_no_reply_keyboard(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ reply keyboard —Å–∫—Ä—ã—Ç–∞ (–¥–ª—è –∫–æ–º–∞–Ω–¥ –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É)"""
    await self._manage_reply_keyboard(update, context, keyboard_type=None)
```

–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç `_manage_reply_keyboard` —Å `keyboard_type=None`, —á—Ç–æ —Å–∫—Ä—ã–≤–∞–µ—Ç –ª—é–±—É—é –∞–∫—Ç–∏–≤–Ω—É—é reply keyboard.

## –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã `/test`

**–ë—ã–ª–æ:**
```python
async def test_command(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Handle /test command - –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã –∏ –≤—ã–≤–æ–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç"""
    try:
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        await self._send_message_safe(update, "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤... –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...")
```

**–°—Ç–∞–ª–æ:**
```python
async def test_command(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Handle /test command - –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã –∏ –≤—ã–≤–æ–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç"""
    # Ensure no reply keyboard is shown
    await self._ensure_no_reply_keyboard(update, context)
    
    try:
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        await self._send_message_safe(update, "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤... –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...")
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

### ‚úÖ –ö–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞—é—Ç reply keyboard:
- `/start` - —Å–∫—Ä—ã–≤–∞–µ—Ç keyboard –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç welcome message
- `/help` - —Å–∫—Ä—ã–≤–∞–µ—Ç keyboard –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É
- `/info` - —Å–∫—Ä—ã–≤–∞–µ—Ç keyboard –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- `/list` - —Å–∫—Ä—ã–≤–∞–µ—Ç keyboard –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ namespace
- `/search` - —Å–∫—Ä—ã–≤–∞–µ—Ç keyboard –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–º–µ—Ä—ã –ø–æ–∏—Å–∫–∞
- `/compare` - —Å–∫—Ä—ã–≤–∞–µ—Ç keyboard –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–º–µ—Ä—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- `/portfolio` - —Å–∫—Ä—ã–≤–∞–µ—Ç keyboard –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–º–µ—Ä—ã —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—è

### ‚úÖ –ö–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:
- `/test` - —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ—Ç keyboard –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Ç–µ—Å—Ç–æ–≤

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –§—É–Ω–∫—Ü–∏—è `_ensure_no_reply_keyboard`:
1. –í—ã–∑—ã–≤–∞–µ—Ç `_manage_reply_keyboard(update, context, keyboard_type=None)`
2. `_manage_reply_keyboard` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â—É—é –∞–∫—Ç–∏–≤–Ω—É—é keyboard
3. –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è keyboard, –æ–Ω–∞ —É–¥–∞–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `_remove_reply_keyboard_silently`
4. –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è: `active_reply_keyboard=None`

### –§—É–Ω–∫—Ü–∏—è `_manage_reply_keyboard`:
```python
# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–∫—Ä—ã—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
if keyboard_type is None:
    if current_keyboard is not None:
        self.logger.info(f"Removing active reply keyboard: {current_keyboard}")
        try:
            await self._remove_reply_keyboard_silently(update, context)
        except Exception as e:
            self.logger.warning(f"Primary keyboard removal failed: {e}, trying alternative method")
            await self._remove_reply_keyboard_alternative(update, context)
        self._update_user_context(user_id, active_reply_keyboard=None)
    return
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

1. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å —Å–∫—Ä—ã–≤–∞—é—Ç reply keyboard
2. **–ß–∏—Å—Ç—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: –ü—Ä–∏ –≤—ã–∑–æ–≤–µ —Å–ø—Ä–∞–≤–∫–∏ keyboard –Ω–µ –º–µ—à–∞–µ—Ç —á—Ç–µ–Ω–∏—é
3. **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**: Keyboard —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º help —Å–æ–æ–±—â–µ–Ω–∏–π
4. **–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è**: –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –ª–æ–≥–∏–∫—É

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
1. –í—ã–∑–æ–≤ `/info` —Å –∞–∫—Ç–∏–≤–Ω–æ–π portfolio keyboard - –¥–æ–ª–∂–Ω–∞ —Å–∫—Ä—ã—Ç—å—Å—è
2. –í—ã–∑–æ–≤ `/compare` —Å –∞–∫—Ç–∏–≤–Ω–æ–π compare keyboard - –¥–æ–ª–∂–Ω–∞ —Å–∫—Ä—ã—Ç—å—Å—è  
3. –í—ã–∑–æ–≤ `/portfolio` —Å –∞–∫—Ç–∏–≤–Ω–æ–π list keyboard - –¥–æ–ª–∂–Ω–∞ —Å–∫—Ä—ã—Ç—å—Å—è
4. –í—ã–∑–æ–≤ `/help` —Å –ª—é–±–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π keyboard - –¥–æ–ª–∂–Ω–∞ —Å–∫—Ä—ã—Ç—å—Å—è
5. –í—ã–∑–æ–≤ `/test` —Å –ª—é–±–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π keyboard - –¥–æ–ª–∂–Ω–∞ —Å–∫—Ä—ã—Ç—å—Å—è

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã
- `bot.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `test_command`

## –°—Ç–∞—Ç—É—Å
üü¢ **–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞—é—Ç reply keyboard**

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ —Ç–æ–ª—å–∫–æ –≤ –∫–æ–º–∞–Ω–¥–µ `/test`, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ —Å–∫—Ä—ã–≤–∞–ª–∞ keyboard. –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã —É–∂–µ —Ä–∞–±–æ—Ç–∞–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
