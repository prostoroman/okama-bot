# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ callback –≤ –∫–æ–º–∞–Ω–¥–µ /list

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ –∏–º–µ–Ω (US, MOEX –∏ –¥—Ä.) –≤ –∫–æ–º–∞–Ω–¥–µ `/list` –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:

```
‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è 'US': Inline keyboard expected
‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è 'MOEX': Inline keyboard expected
```

## –ü—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏

–û—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö `_show_namespace_symbols` –∏ `_show_tushare_namespace_symbols` –º—ã –∑–∞–º–µ–Ω–∏–ª–∏ `InlineKeyboardMarkup` –Ω–∞ `ReplyKeyboardMarkup` –¥–ª—è –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤, –≤–∫–ª—é—á–∞—è callback-—Å–æ–æ–±—â–µ–Ω–∏—è.

Telegram API –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —Å inline keyboard, –ø–µ—Ä–µ–¥–∞–≤–∞—è reply keyboard - —ç—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É "Inline keyboard expected".

## –†–µ—à–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≥–∏–±—Ä–∏–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä:

### 1. –î–ª—è callback-—Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–æ–∫ –≤ `/list`)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **InlineKeyboardMarkup** (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤—Å—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å inline –∫–Ω–æ–ø–æ–∫
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

### 2. –î–ª—è –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –∫–æ–º–∞–Ω–¥—ã (`/list US`, `/list MOEX`)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **ReplyKeyboardMarkup** (–Ω–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)
- –ö–Ω–æ–ø–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –§–∞–π–ª: `bot.py`

#### –§—É–Ω–∫—Ü–∏—è: `_show_namespace_symbols()`

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
# Create reply keyboard instead of inline keyboard
reply_markup = self._create_list_namespace_reply_keyboard(namespace, current_page, total_pages, total_symbols)
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
# Create appropriate keyboard based on context
if is_callback:
    # For callback messages, use inline keyboard (original behavior)
    keyboard = []
    # ... —Å–æ–∑–¥–∞–Ω–∏–µ inline keyboard ...
    reply_markup = InlineKeyboardMarkup(keyboard)
else:
    # For direct command calls, use reply keyboard
    reply_markup = self._create_list_namespace_reply_keyboard(namespace, current_page, total_pages, total_symbols)
```

#### –§—É–Ω–∫—Ü–∏—è: `_show_tushare_namespace_symbols()`

–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –∫–∏—Ç–∞–π—Å–∫–∏—Ö –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ –∏–º–µ–Ω.

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### Callback-—Å–æ–æ–±—â–µ–Ω–∏—è (is_callback=True)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É –≤ `/list` –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
2. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è —Å `is_callback=True`
3. –°–æ–∑–¥–∞–µ—Ç—Å—è `InlineKeyboardMarkup` —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏
4. –°–æ–æ–±—â–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è —Å inline keyboard

### –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã (is_callback=False)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç `/list US` –∏–ª–∏ `/list MOEX`
2. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è —Å `is_callback=False`
3. –°–æ–∑–¥–∞–µ—Ç—Å—è `ReplyKeyboardMarkup` —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–µ–π—Å—Ç–≤–∏–π
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å reply keyboard
5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–æ–∫

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### Inline Keyboard (callback-—Å–æ–æ–±—â–µ–Ω–∏—è)
- ‚¨ÖÔ∏è –ù–∞–∑–∞–¥ / ‚û°Ô∏è –í–ø–µ—Ä–µ–¥ - –Ω–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
- üìä Excel - —ç–∫—Å–ø–æ—Ä—Ç –≤ Excel
- üè† –î–æ–º–æ–π - –≤–æ–∑–≤—Ä–∞—Ç –∫ —Å–ø–∏—Å–∫—É –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ –∏–º–µ–Ω
- üîç –ê–Ω–∞–ª–∏–∑, ‚öñÔ∏è –°—Ä–∞–≤–Ω–∏—Ç—å, üíº –í –ø–æ—Ä—Ç—Ñ–µ–ª—å - –¥–µ–π—Å—Ç–≤–∏—è

### Reply Keyboard (–ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã)
- ‚¨ÖÔ∏è –ù–∞–∑–∞–¥ / ‚û°Ô∏è –í–ø–µ—Ä–µ–¥ - –Ω–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
- üìä Excel - —ç–∫—Å–ø–æ—Ä—Ç –≤ Excel
- üîç –ê–Ω–∞–ª–∏–∑, ‚öñÔ∏è –°—Ä–∞–≤–Ω–∏—Ç—å, üíº –í –ø–æ—Ä—Ç—Ñ–µ–ª—å - –¥–µ–π—Å—Ç–≤–∏—è
- üè† –î–æ–º–æ–π - –≤–æ–∑–≤—Ä–∞—Ç –∫ —Å–ø–∏—Å–∫—É –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ –∏–º–µ–Ω

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–∞
```bash
python3 -c "import bot; print('Bot imports successfully after fixes')"
```
‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å–ø–µ—à–Ω–æ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ callback-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∫ inline, —Ç–∞–∫ –∏ reply keyboard
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ –∏–º–µ–Ω

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–û—à–∏–±–∫–∞ "Inline keyboard expected" —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞. –¢–µ–ø–µ—Ä—å –∫–æ–º–∞–Ω–¥–∞ `/list` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–∞—Ö:

1. **–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–æ–∫ –≤ `/list`** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è inline keyboard
2. **–ü—Ä–∏ –ø—Ä—è–º–æ–º –≤–≤–æ–¥–µ `/list <–∫–æ–¥>`** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è reply keyboard

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–∞ —Å–ø–æ—Å–æ–±–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –±–µ–∑ –æ—à–∏–±–æ–∫.
