# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –∫–æ–º–∞–Ω–¥—ã /info

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª –æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫–æ–º–∞–Ω–¥–µ `/info`:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:** `/info`
2. **–ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:** "üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–∫—Ç–∏–≤–µ –ü—Ä–∏–º–µ—Ä—ã: BP.LSE, HSBA.LSE, SI.COMM –ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞"
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:** `HSBA.LSE`
4. **–ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:** "‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: HSBA.LSE. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Å–∏–º–≤–æ–ª:–¥–æ–ª—è"
5. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:** `BP.LSE`
6. **–ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:** "–í—ã —É–∫–∞–∑–∞–ª–∏ —Ç–æ–ª—å–∫–æ 1 —Å–∏–º–≤–æ–ª, –∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –Ω—É–∂–Ω–æ 2 –∏ –±–æ–ª—å—à–µ, –Ω–∞–ø–∏—à–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä AGG.US, 800001.BJ, SI.COMM"

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `handle_message` –≤ —Ñ–∞–π–ª–µ `bot.py`. –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–ª —Å–∏–º–≤–æ–ª –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã `/info`, —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–ª–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞–ª–∞ —ç—Ç–æ –∫–∞–∫ –∫–æ–º–∞–Ω–¥—É —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (`/compare`).

### –õ–æ–≥–∏–∫–∞ –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```python
# Check if user is waiting for compare input or has stored compare symbol
if user_context.get('waiting_for_compare', False) or user_context.get('compare_first_symbol') or user_context.get('compare_base_symbol'):
    self.logger.info(f"Processing as compare input: {text}")
    # Process as compare input
    await self._handle_compare_input(update, context, text)
    return
```

–≠—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∞ –¥–∞–∂–µ –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å—Ç–æ —Ö–æ—Ç–µ–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `/info`, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –∑–Ω–∞–ª–∞, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∫–æ–º–∞–Ω–¥—ã `/info` –∏ –æ–∂–∏–¥–∞–µ—Ç –≤–≤–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞.

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `waiting_for_info` –≤ –∫–æ–º–∞–Ω–¥—É `/info`

**–§–∞–π–ª:** `bot.py` - —Ñ—É–Ω–∫—Ü–∏—è `info_command`

```python
async def info_command(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Handle /info command - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ —Å –±–∞–∑–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏ AI –∞–Ω–∞–ª–∏–∑–æ–º"""
    if not context.args:
        # Get random examples for user
        examples = self.get_random_examples(3)
        examples_text = ", ".join(examples)
        
        # Set flag that user is waiting for info input
        user_id = update.effective_user.id
        self._update_user_context(user_id, waiting_for_info=True)
        
        await self._send_message_safe(update, 
            f"üìä *–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–∫—Ç–∏–≤–µ*\n\n"
            f"*–ü—Ä–∏–º–µ—Ä—ã:* {examples_text}\n\n"
            f"*–ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞*")
        return
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –≤ `handle_message`

**–§–∞–π–ª:** `bot.py` - —Ñ—É–Ω–∫—Ü–∏—è `handle_message`

```python
# Check if user is waiting for info input
if user_context.get('waiting_for_info', False):
    self.logger.info(f"Processing as info input: {text}")
    # Clear the waiting flag
    self._update_user_context(user_id, waiting_for_info=False)
    # Process as info command with the symbol
    context.args = [text]
    await self.info_command(update, context)
    return
```

### 3. –û—á–∏—Å—Ç–∫–∞ —Ñ–ª–∞–≥–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤

**–§–∞–π–ª:** `bot.py` - —Ñ—É–Ω–∫—Ü–∏—è `info_command`

```python
symbol = self.clean_symbol(context.args[0]).upper()

# Update user context
user_id = update.effective_user.id
self._update_user_context(user_id, 
                        last_assets=[symbol] + self._get_user_context(user_id).get('last_assets', []),
                        waiting_for_info=False)
```

## üìã –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ö–æ–º–∞–Ω–¥–∞ /info –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç:** `/info`
2. **–°–∏—Å—Ç–µ–º–∞:** –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `waiting_for_info=True`
3. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É "–ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞"

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –í–≤–æ–¥ —Å–∏–º–≤–æ–ª–∞ –ø–æ—Å–ª–µ /info
1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç:** `HSBA.LSE`
2. **–°–∏—Å—Ç–µ–º–∞:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `waiting_for_info=True`
3. **–°–∏—Å—Ç–µ–º–∞:** –û—á–∏—â–∞–µ—Ç —Ñ–ª–∞–≥ `waiting_for_info=False`
4. **–°–∏—Å—Ç–µ–º–∞:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∫ –∫–æ–º–∞–Ω–¥—É `/info HSBA.LSE`
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞–∫—Ç–∏–≤–µ HSBA.LSE

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ö–æ–º–∞–Ω–¥–∞ /info —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏
1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç:** `/info HSBA.LSE`
2. **–°–∏—Å—Ç–µ–º–∞:** –û—á–∏—â–∞–µ—Ç —Ñ–ª–∞–≥ `waiting_for_info=False`
3. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞–∫—Ç–∏–≤–µ HSBA.LSE

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –∫–æ–º–∞–Ω–¥–∞ `/info` —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

1. ‚úÖ **–ö–æ–º–∞–Ω–¥–∞ `/info`** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ –æ–∂–∏–¥–∞–Ω–∏—è
2. ‚úÖ **–í–≤–æ–¥ —Å–∏–º–≤–æ–ª–∞** –ø–æ—Å–ª–µ `/info` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –∫–æ–º–∞–Ω–¥–∞ `/info`, –∞ –Ω–µ `/compare`
3. ‚úÖ **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è** —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
4. ‚úÖ **–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è

## üìù –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç `tests/test_info_routing_fix.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
- –£—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ñ–ª–∞–≥–∞ `waiting_for_info` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `/info` –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∏ –≤–≤–æ–¥–∞ –∫–∞–∫ –∫–æ–º–∞–Ω–¥—ã `/info` –∫–æ–≥–¥–∞ `waiting_for_info=True`
- –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–ª–∞–≥–∞ –∫–æ–≥–¥–∞ `waiting_for_info=False`

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã –≤ —Ñ–∞–π–ª `bot.py` –∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** - –ö–æ–º–∞–Ω–¥–∞ `/info` —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π —Å–æ–æ–±—â–µ–Ω–∏–π
