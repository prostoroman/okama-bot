# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ —Å –∫–Ω–æ–ø–∫–æ–π –ø—Ä–æ—Å–∞–¥–æ–∫ –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "üìâ –ü—Ä–æ—Å–∞–¥–∫–∏" –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
‚ùå –î–∞–Ω–Ω—ã–µ –æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É /compare –∑–∞–Ω–æ–≤–æ.
```

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–æ–±–ª–µ–º–∞ –∑–∞–∫–ª—é—á–∞–ª–∞—Å—å –≤ —Ç–æ–º, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–æ–∫ –ø–æ—Ä—Ç—Ñ–µ–ª—è (`_handle_portfolio_*_button`) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ—Å–æ–≤ –ø–æ—Ä—Ç—Ñ–µ–ª—è:

1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞**: –§—É–Ω–∫—Ü–∏–∏ –ø—ã—Ç–∞–ª–∏—Å—å –ø–æ–ª—É—á–∏—Ç—å –≤–µ—Å–∞ –∏–∑ `user_context.get('portfolio_weights', [])`, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ fallback**: –ï—Å–ª–∏ –≤–µ—Å–∞ –Ω–µ –±—ã–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ –∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–ª–æ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–∏–º–≤–æ–ª–æ–≤, —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–≥–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—å
3. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞**: –ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –≤–æ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–æ–∫ –ø–æ—Ä—Ç—Ñ–µ–ª—è

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –§—É–Ω–∫—Ü–∏—è `_handle_portfolio_drawdowns_button`

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
currency = user_context.get('current_currency', 'USD')
raw_weights = user_context.get('portfolio_weights', [])
weights = self._normalize_or_equalize_weights(final_symbols, raw_weights)
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
# Check if we have portfolio-specific data
portfolio_weights = user_context.get('portfolio_weights', [])
portfolio_currency = user_context.get('current_currency', 'USD')

# If we have portfolio weights, use them; otherwise use equal weights
if portfolio_weights and len(portfolio_weights) == len(final_symbols):
    weights = portfolio_weights
    currency = portfolio_currency
    self.logger.info(f"Using stored portfolio weights: {weights}")
else:
    # Fallback to equal weights if no portfolio weights found
    weights = self._normalize_or_equalize_weights(final_symbols, [])
    currency = user_context.get('current_currency', 'USD')
    self.logger.info(f"Using equal weights as fallback: {weights}")
```

### 2. –§—É–Ω–∫—Ü–∏—è `_handle_portfolio_returns_button`

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ—Å–æ–≤ –ø–æ—Ä—Ç—Ñ–µ–ª—è.

### 3. –§—É–Ω–∫—Ü–∏—è `_handle_risk_metrics_button`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –≤–µ—Å–æ–≤ –ø–æ—Ä—Ç—Ñ–µ–ª—è —Å fallback –Ω–∞ —Ä–∞–≤–Ω—ã–µ –≤–µ—Å–∞.

### 4. –§—É–Ω–∫—Ü–∏—è `_handle_monte_carlo_button`

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –≤–µ—Å–∞–º–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è.

### 5. –§—É–Ω–∫—Ü–∏—è `_handle_forecast_button`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ fallback –¥–ª—è –≤–µ—Å–æ–≤ –ø–æ—Ä—Ç—Ñ–µ–ª—è.

### 6. –§—É–Ω–∫—Ü–∏—è `_handle_portfolio_rolling_cagr_button`

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ—Å–æ–≤ –ø–æ—Ä—Ç—Ñ–µ–ª—è.

### 7. –§—É–Ω–∫—Ü–∏—è `_handle_portfolio_compare_assets_button`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –≤–µ—Å–æ–≤ –ø–æ—Ä—Ç—Ñ–µ–ª—è.

## –õ–æ–≥–∏–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:

1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –≤–µ—Å–æ–≤**: –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –≤–µ—Å–∞ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–µ—Å–æ–≤ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–∏–º–≤–æ–ª–æ–≤
3. **Fallback –Ω–∞ —Ä–∞–≤–Ω—ã–µ –≤–µ—Å–∞**: –ï—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –≤–µ—Å–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–≤–Ω—ã–µ –≤–µ—Å–∞ –¥–ª—è –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–æ–≤
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### –ê–ª–≥–æ—Ä–∏—Ç–º:

```python
# Check if we have portfolio-specific data
portfolio_weights = user_context.get('portfolio_weights', [])
portfolio_currency = user_context.get('current_currency', 'USD')

# If we have portfolio weights, use them; otherwise use equal weights
if portfolio_weights and len(portfolio_weights) == len(final_symbols):
    weights = portfolio_weights
    currency = portfolio_currency
    self.logger.info(f"Using stored portfolio weights: {weights}")
else:
    # Fallback to equal weights if no portfolio weights found
    weights = self._normalize_or_equalize_weights(final_symbols, [])
    currency = user_context.get('current_currency', 'USD')
    self.logger.info(f"Using equal weights as fallback: {weights}")
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

1. ‚úÖ –ö–Ω–æ–ø–∫–∞ "üìâ –ü—Ä–æ—Å–∞–¥–∫–∏" —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
2. ‚úÖ –í—Å–µ –∫–Ω–æ–ø–∫–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ—Å–æ–≤
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω fallback –Ω–∞ —Ä–∞–≤–Ω—ã–µ –≤–µ—Å–∞ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. ‚úÖ –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
5. ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –æ—à–∏–±–∫–∞ "–î–∞–Ω–Ω—ã–µ –æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É `/portfolio` —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∞–∫—Ç–∏–≤–æ–≤ –∏ –≤–µ—Å–æ–≤
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìâ –ü—Ä–æ—Å–∞–¥–∫–∏"
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≥—Ä–∞—Ñ–∏–∫ –ø—Ä–æ—Å–∞–¥–æ–∫ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –¥—Ä—É–≥–∏—Ö –∫–Ω–æ–ø–æ–∫ –ø–æ—Ä—Ç—Ñ–µ–ª—è

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

- `bot.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–æ–∫ –ø–æ—Ä—Ç—Ñ–µ–ª—è

## –î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

$(date)

## –°—Ç–∞—Ç—É—Å

‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** - –û—à–∏–±–∫–∞ —Å –∫–Ω–æ–ø–∫–æ–π –ø—Ä–æ—Å–∞–¥–æ–∫ –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞
