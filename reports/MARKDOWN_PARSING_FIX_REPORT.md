# Markdown Parsing Fix Report

## –ü—Ä–æ–±–ª–µ–º–∞

**–î–∞—Ç–∞:** 2025-01-27  
**–û—à–∏–±–∫–∞:** `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è 'SSE': Can't parse entities: can't find end of the entity starting at byte offset 109`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### üîç **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

**–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Ç–∞–±–ª–∏—Ü:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `tablefmt="pipe"` –≤ tabulate (—Å–æ–∑–¥–∞–µ—Ç Markdown —Ç–∞–±–ª–∏—Ü—É)
- –û—Ç–ø—Ä–∞–≤–ª—è–ª–æ—Å—å —Å `parse_mode='Markdown'` –≤ Telegram
- –°–∏–º–≤–æ–ª—ã `|` –∏ `-` –≤ —Ç–∞–±–ª–∏—Ü–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞–ª–∏ —Å Markdown –ø–∞—Ä—Å–µ—Ä–æ–º Telegram

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã:**
```
| –°–∏–º–≤–æ–ª      | –ù–∞–∑–≤–∞–Ω–∏–µ                                                     |
|:------------|:-------------------------------------------------------------|
| `600000.SH` | Shanghai Pudong Development Bank Co\.,Ltd\.                  |
| `600004.SH` | Guangzhou Baiyun International Airport Company Limited       |
```

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã:**
- `|` (pipe) - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ –≤ Markdown —Ç–∞–±–ª–∏—Ü–∞—Ö
- `-` (dash) - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ Markdown —Ç–∞–±–ª–∏—Ü–∞—Ö
- `:` (colon) - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –≤ Markdown —Ç–∞–±–ª–∏—Ü–∞—Ö

## –†–µ—à–µ–Ω–∏–µ

### ‚úÖ **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**

**1. –ò–∑–º–µ–Ω–µ–Ω —Ñ–æ—Ä–º–∞—Ç —Ç–∞–±–ª–∏—Ü—ã –≤ `_show_tushare_namespace_symbols`:**
```python
# Before (–ø—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥)
table = tabulate.tabulate(table_data, headers=headers, tablefmt="pipe")
response += table + "\n"

# After (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥)
table = tabulate.tabulate(table_data, headers=headers, tablefmt="simple")
response += f"```\n{table}\n```\n"
```

**2. –ò–∑–º–µ–Ω–µ–Ω —Ñ–æ—Ä–º–∞—Ç —Ç–∞–±–ª–∏—Ü—ã –≤ `_show_namespace_symbols`:**
```python
# Before (–ø—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥)
table = tabulate.tabulate(table_data, headers=headers, tablefmt="pipe")
response += table + "\n"

# After (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥)
table = tabulate.tabulate(table_data, headers=headers, tablefmt="simple")
response += f"```\n{table}\n```\n"
```

### ‚úÖ **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**

**–§–æ—Ä–º–∞—Ç "simple" –≤ tabulate:**
- –°–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Å—Ç—É—é —Ç–µ–∫—Å—Ç–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É –±–µ–∑ Markdown —Å–∏–º–≤–æ–ª–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–±–µ–ª—ã –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è
- –ù–µ —Å–æ–¥–µ—Ä–∂–∏—Ç `|`, `-`, `:` –∫–æ—Ç–æ—Ä—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç —Å Markdown

**–û–±–µ—Ä—Ç–∫–∞ –≤ code block:**
- –¢–∞–±–ª–∏—Ü–∞ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ ``` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞–∫ –∫–æ–¥
- –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∫–∞–∫ Markdown
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ø—Ä–æ–±–ª–µ–º–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞):**
```
| –°–∏–º–≤–æ–ª      | –ù–∞–∑–≤–∞–Ω–∏–µ                                                     |
|:------------|:-------------------------------------------------------------|
| `600000.SH` | Shanghai Pudong Development Bank Co\.,Ltd\.                  |
| `600004.SH` | Guangzhou Baiyun International Airport Company Limited       |
```

### ‚úÖ **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Ä–∞–±–æ—á–∞—è —Ç–∞–±–ª–∏—Ü–∞):**
```
```
–°–∏–º–≤–æ–ª       –ù–∞–∑–≤–∞–Ω–∏–µ
-----------  ------------------------------------------------------------
`600000.SH`  Shanghai Pudong Development Bank Co\.,Ltd\.
`600004.SH`  Guangzhou Baiyun International Airport Company Limited
`600006.SH`  Dongfeng Automobile Co\.,Ltd\.
`600007.SH`  China World Trade Center Co\.,Ltd\.
`600008.SH`  Beijing Capital Eco\-Environment Protection Group Co\.,Ltd\.
```
```

### ‚úÖ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞:**
- ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å Markdown –ø–∞—Ä—Å–µ—Ä–æ–º
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å —Ç–∞–±–ª–∏—Ü
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –±–∏—Ä–∂ (–∫–∏—Ç–∞–π—Å–∫–∏—Ö –∏ –æ–±—ã—á–Ω—ã—Ö)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ **–°–æ–∑–¥–∞–Ω –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç:**
- `scripts/debug_markdown_error.py` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã
- `scripts/test_markdownv2.py` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Markdown vs MarkdownV2
- `scripts/test_markdown_fix.py` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### ‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- ‚úÖ –§–æ—Ä–º–∞—Ç "simple": –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ù–µ—Ç —Å–∏–º–≤–æ–ª–æ–≤ `|` –∏ `-`: –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
- ‚úÖ Code block –æ–±–µ—Ä—Ç–∫–∞: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç Markdown –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é
- ‚úÖ –í—Å–µ –±–∏—Ä–∂–∏: –†–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ

### ‚úÖ **–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å–ª—É—á–∞–∏:**
- SSE (Shanghai Stock Exchange): ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- SZSE (Shenzhen Stock Exchange): ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç  
- BSE (Beijing Stock Exchange): ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- HKEX (Hong Kong Stock Exchange): ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- –û–±—ã—á–Ω—ã–µ –±–∏—Ä–∂–∏: ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### **–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `bot.py` - –∏–∑–º–µ–Ω–µ–Ω —Ñ–æ—Ä–º–∞—Ç —Ç–∞–±–ª–∏—Ü –≤ –¥–≤—É—Ö –º–µ—Ç–æ–¥–∞—Ö

### **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ TABULATE —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ
- ‚úÖ Markdown —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ
- ‚úÖ –ö–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Excel —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –ø—Ä–µ–∂–¥–µ
- ‚úÖ –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è –∫–∏—Ç–∞–π—Å–∫–∏—Ö –±–∏—Ä–∂ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

### **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- –£–ª—É—á—à–µ–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
- –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å Telegram API

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞:**
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –æ—à–∏–±–∫–∞ "Can't parse entities"
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ü—Ä–æ–≤–µ–¥–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞—é—Ç:**
- –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞
- –ß–∏—Ç–∞–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –≤—Å–µ—Ö –±–∏—Ä–∂
- –ù–∞–¥–µ–∂–Ω—É—é —Ä–∞–±–æ—Ç—É –∫–æ–º–∞–Ω–¥—ã `/list`

**–ö–æ–º–º–∏—Ç:** –ì–æ—Ç–æ–≤ –∫ –∫–æ–º–º–∏—Ç—É - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ! üéâ