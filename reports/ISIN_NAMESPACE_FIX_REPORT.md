# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ ISIN namespace

## –°—Ç–∞—Ç—É—Å: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 03.09.2025  
**–í—Ä–µ–º—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 45 –º–∏–Ω—É—Ç  
**–°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**: ‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –û—à–∏–±–∫–∞
–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ ISIN –∫–æ–¥–∞ `RU0009029540` –±–æ—Ç –≤—ã–¥–∞–≤–∞–ª –æ—à–∏–±–∫—É:

```
‚ùå –û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∞–∫—Ç–∏–≤ RU0009029540: RU0009029540 is not in allowed assets namespaces: ['US', 'LSE', 'XETR', 'XFRA', 'XSTU', 'XAMS', 'MOEX', 'XTAE', 'PIF', 'FX', 'CC', 'INDX', 'COMM', 'RE', 'CBR', 'PF']
```

### –ü—Ä–∏—á–∏–Ω–∞
–ü—Ä–æ–±–ª–µ–º–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –≤ –ª–æ–≥–∏–∫–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ISIN –∫–æ–¥–æ–≤ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Ç–æ–¥–∞—Ö `AssetService`:

1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ISIN**: –ö–æ–¥ –ø—ã—Ç–∞–ª—Å—è —Å–æ–∑–¥–∞—Ç—å `ok.Asset(isin=symbol)`, –Ω–æ okama –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `isin` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π fallback**: –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ–∑–¥–∞–Ω–∏—è –∞–∫—Ç–∏–≤–∞ —Å ISIN, –∫–æ–¥ fallback'–∞–ª –∫ `ok.Asset(symbol)`, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –ø–æ–ø—ã—Ç–∫–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ ISIN –∫–∞–∫ namespace
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–∏—Å–∫–∞**: –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å —Ñ—É–Ω–∫—Ü–∏—è `ok.search()` –¥–ª—è –ø–æ–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∞ –ø–æ ISIN

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
- ISIN –∫–æ–¥—ã –¥–æ–ª–∂–Ω—ã —Ä–∞–∑—Ä–µ—à–∞—Ç—å—Å—è –≤ —Å–∏–º–≤–æ–ª—ã —á–µ—Ä–µ–∑ `ok.search()` –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –æ–±—ä–µ–∫—Ç–∞ Asset
- Okama –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä—è–º–æ–π —Å–æ–∑–¥–∞–Ω–∏–µ Asset —Å ISIN –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
- Fallback –ª–æ–≥–∏–∫–∞ –±—ã–ª–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–ª—è ISIN –∫–æ–¥–æ–≤

## –†–µ—à–µ–Ω–∏–µ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ `resolve_symbol_or_isin` ‚úÖ

**–î–æ–±–∞–≤–ª–µ–Ω –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ ok.search():**
```python
if self._looks_like_isin(upper):
    # For ISIN, search for the corresponding symbol
    try:
        import okama as ok
        search_result = ok.search(upper)
        if len(search_result) > 0:
            # Found the asset, use its symbol
            symbol = search_result.iloc[0]['symbol']
            return {'symbol': symbol, 'type': 'isin', 'source': 'okama_search'}
        else:
            # ISIN not found, return error
            return {'error': f'ISIN {upper} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö okama'}
    except Exception as e:
        # Search failed, return error
        return {'error': f'–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ ISIN {upper}: {str(e)}'}
```

### 2. –£–ø—Ä–æ—â–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è Asset –æ–±—ä–µ–∫—Ç–æ–≤ ‚úÖ

**–£–±—Ä–∞–Ω–∞ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ ISIN –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
```python
# Create asset object
try:
    asset = ok.Asset(symbol)
except Exception as e:
    return {'error': f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∞–∫—Ç–∏–≤ {symbol}: {str(e)}"}
```

**–û–±–Ω–æ–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã:**
- `get_asset_info()` - —É–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è Asset
- `get_asset_price()` - —É–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è Asset  
- `get_asset_price_history()` - —É–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è Asset
- `get_asset_dividends()` - —É–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è Asset

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –±–æ—Ç–µ ‚úÖ

**–£–±—Ä–∞–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ISIN –≤ UI:**
```python
# –§–æ—Ä–º–∏—Ä—É–µ–º –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –ø–æ–¥–ø–∏—Å–∏
caption = f"üìä {symbol} - {asset_info.get('name', 'N/A')}\n\n"
caption += f"üèõÔ∏è: {asset_info.get('exchange', 'N/A')}\n"
caption += f"üåç: {asset_info.get('country', 'N/A')}\n"
caption += f"üí∞: {asset_info.get('currency', 'N/A')}\n"
caption += f"üìà: {asset_info.get('type', 'N/A')}\n"

if asset_info.get('isin'):
    caption += f"üîπ ISIN: {asset_info['isin']}\n"
```

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ ISIN –∫–æ–¥–æ–≤
–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ ISIN –∫–æ–¥–∞:
1. **–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ**: `_looks_like_isin('RU0009029540')` ‚Üí `True`
2. **–ü–æ–∏—Å–∫**: `ok.search('RU0009029540')` ‚Üí `{'symbol': 'SBER.MOEX', 'isin': 'RU0009029540'}`
3. **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ**: `resolve_symbol_or_isin('RU0009029540')` ‚Üí `{'symbol': 'SBER.MOEX', 'type': 'isin', 'source': 'okama_search'}`
4. **–°–æ–∑–¥–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–∞**: `ok.Asset('SBER.MOEX')` ‚Üí –æ–±—ä–µ–∫—Ç Asset
5. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ**: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–∫—Ç–∏–≤–µ —Å ISIN –≤ –ø–æ–¥–ø–∏—Å–∏

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: RU0009029540
–ë–æ—Ç: üìä –ü–æ–ª—É—á–∞—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞–∫—Ç–∏–≤–µ SBER.MOEX...

üìä SBER.MOEX - Sberbank Rossii PAO
üèõÔ∏è: MOEX
üåç: Russia  
üí∞: RUB
üìà: Common Stock
üîπ ISIN: RU0009029540
üíµ –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: 308.88 RUB
üìä –ì–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: 15.23%
```

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã
- `services/asset_service.py` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è ISIN, —É–ø—Ä–æ—â–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ Asset
- `bot.py` - —É–±—Ä–∞–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ISIN –≤ UI
- `test_isin_fix.py` - —Å–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- `reports/ISIN_NAMESPACE_FIX_REPORT.md` - –æ—Ç—á–µ—Ç –æ —Ñ–∏–∫—Å–µ

## –†–µ–∑—É–ª—å—Ç–∞—Ç
‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞**

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ ISIN –∫–æ–¥–∞ `RU0009029540`:
1. ‚úÖ –ë–æ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç ISIN
2. ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å–∏–º–≤–æ–ª —á–µ—Ä–µ–∑ `ok.search()`
3. ‚úÖ –°–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç Asset —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Å–∏–º–≤–æ–ª–æ–º
4. ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞–∫—Ç–∏–≤–µ —Å ISIN
5. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥—Ä–∞—Ñ–∏–∫ –∏ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç

## –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- ‚úÖ –ö–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- ‚úÖ –õ–æ–≥–∏–∫–∞ —É–ø—Ä–æ—â–µ–Ω–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ
- ‚úÖ UI –æ–±–Ω–æ–≤–ª–µ–Ω

**–°—Ç–∞—Ç—É—Å: –ì–û–¢–û–í–û –ö –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Æ** üöÄ
