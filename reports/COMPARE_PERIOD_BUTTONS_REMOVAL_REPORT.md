# –û—Ç—á–µ—Ç –æ–± —É–¥–∞–ª–µ–Ω–∏–∏ –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–∏–æ–¥–∞ –∏–∑ –∫–æ–º–∞–Ω–¥—ã /compare

## üéØ –¶–µ–ª—å
–£–¥–∞–ª–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–∏–æ–¥–∞ (1 –≥–æ–¥, 5 –ª–µ—Ç, MAX) –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –Ω–∏–º–∏ –∫–æ–¥ –∏–∑ –∫–æ–º–∞–Ω–¥—ã `/compare` –≤ –≥—Ä–∞—Ñ–∏–∫–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏.

## üîç –ê–Ω–∞–ª–∏–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –£–¥–∞–ª–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
1. **–ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–∏–æ–¥–∞**: Inline –∫–Ω–æ–ø–∫–∏ "1 –≥–æ–¥", "5 –ª–µ—Ç", "MAX" –ø–æ–¥ –≥—Ä–∞—Ñ–∏–∫–æ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
2. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫**: –§—É–Ω–∫—Ü–∏—è `_handle_compare_period_button()`
3. **Callback –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ `compare_period_*` –≤ `button_callback()`
4. **–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã**: –§—É–Ω–∫—Ü–∏—è `_create_period_selection_keyboard()`

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø–µ—Ä–∏–æ–¥–∞ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ compare_command

**–§–∞–π–ª:** `bot.py`
**–°—Ç—Ä–æ–∫–∏:** 4394-4395

**–ë—ã–ª–æ:**
```python
# Create keyboard with period selection only
reply_markup = self._create_period_selection_keyboard(symbols, "compare")
```

**–°—Ç–∞–ª–æ:**
```python
# No period selection keyboard needed
reply_markup = None
```

### 2. –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø–µ—Ä–∏–æ–¥–∞ –∏–∑ _create_comparison_wealth_chart

**–§–∞–π–ª:** `bot.py`
**–°—Ç—Ä–æ–∫–∏:** 9918-9923

**–ë—ã–ª–æ:**
```python
# Create keyboard with period selection
keyboard = self._create_period_selection_keyboard(symbols, "compare")

# Send chart with period selection keyboard
await context.bot.send_photo(
    chat_id=update.effective_chat.id,
    photo=img_buffer,
    caption=self._truncate_caption(caption),
    reply_markup=keyboard
)
```

**–°—Ç–∞–ª–æ:**
```python
# Send chart without period selection keyboard
await context.bot.send_photo(
    chat_id=update.effective_chat.id,
    photo=img_buffer,
    caption=self._truncate_caption(caption)
)
```

### 3. –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback'–æ–≤ –ø–µ—Ä–∏–æ–¥–∞

**–§–∞–π–ª:** `bot.py`
**–°—Ç—Ä–æ–∫–∏:** 6641-6657

**–£–¥–∞–ª–µ–Ω –±–ª–æ–∫:**
```python
# Handle period selection callbacks (only for compare)
if callback_data.startswith("compare_period_"):
    # Extract period and symbols from callback data
    parts = callback_data.split("_")
    if len(parts) >= 4:
        command_type = parts[0]  # compare
        period = parts[2]  # 1Y, 5Y, or MAX
        symbols_str = "_".join(parts[3:])  # symbols
        symbols = symbols_str.split(",")
        
        # Update user context with new period
        user_id = update.effective_user.id
        self._update_user_context(user_id, last_period=period)
        
        # Handle compare period button - update chart with new period
        await self._handle_compare_period_button(update, context, symbols, period)
    return
```

### 4. –£–¥–∞–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ _handle_compare_period_button

**–§–∞–π–ª:** `bot.py`
**–°—Ç—Ä–æ–∫–∏:** 9936-9993

**–£–¥–∞–ª–µ–Ω–∞ –≤—Å—è —Ñ—É–Ω–∫—Ü–∏—è:**
```python
async def _handle_compare_period_button(self, update: Update, context: ContextTypes.DEFAULT_TYPE, symbols: list, period: str):
    """Handle compare period button - update chart with new period"""
    # ... (–≤—Å—è —Ñ—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞)
```

### 5. –£–¥–∞–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ _create_period_selection_keyboard

**–§–∞–π–ª:** `bot.py`
**–°—Ç—Ä–æ–∫–∏:** 9916-9933

**–£–¥–∞–ª–µ–Ω–∞ –≤—Å—è —Ñ—É–Ω–∫—Ü–∏—è:**
```python
def _create_period_selection_keyboard(self, symbols: list, command_type: str) -> InlineKeyboardMarkup:
    """Create keyboard with period selection buttons"""
    # ... (–≤—Å—è —Ñ—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞)
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ß—Ç–æ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ:
1. **Inline –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–∏–æ–¥–∞**: "1 –≥–æ–¥", "5 –ª–µ—Ç", "MAX" –ø–æ–¥ –≥—Ä–∞—Ñ–∏–∫–æ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
2. **Callback –æ–±—Ä–∞–±–æ—Ç–∫–∞**: `compare_period_1Y_*`, `compare_period_5Y_*`, `compare_period_MAX_*`
3. **–§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞**: `_handle_compare_period_button()`
4. **–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã**: `_create_period_selection_keyboard()`
5. **–ü–µ—Ä–µ–¥–∞—á–∞ reply_markup**: –£–¥–∞–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `reply_markup` –∏–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤

### –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å:
1. **Reply Keyboard**: –û—Å—Ç–∞–µ—Ç—Å—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º
2. **–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**: –ì—Ä–∞—Ñ–∏–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. **–î—Ä—É–≥–∏–µ –∫–Ω–æ–ø–∫–∏**: –ö–Ω–æ–ø–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏, –¥–∏–≤–∏–¥–µ–Ω–¥–æ–≤, –ø—Ä–æ—Å–∞–¥–æ–∫ –∏ —Ç.–¥.

### –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
- **–î–æ**: –ì—Ä–∞—Ñ–∏–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–ª—Å—è —Å inline –∫–Ω–æ–ø–∫–∞–º–∏ –ø–µ—Ä–∏–æ–¥–∞ (1 –≥–æ–¥, 5 –ª–µ—Ç, MAX)
- **–ü–æ—Å–ª–µ**: –ì—Ä–∞—Ñ–∏–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –±–µ–∑ inline –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–∏–æ–¥–∞
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Reply Keyboard –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
1. **–ö–æ–º–∞–Ω–¥–∞ /compare**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≥—Ä–∞—Ñ–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –±–µ–∑ –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–∏–æ–¥–∞
2. **Reply Keyboard**: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º —Ä–∞–±–æ—Ç–∞–µ—Ç
3. **–î—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. **–û—à–∏–±–∫–∏**: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
- –ì—Ä–∞—Ñ–∏–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –±–µ–∑ inline –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–∏–æ–¥–∞
- Reply Keyboard –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –ø—Ä–µ–∂–¥–µ

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–∏–æ–¥–∞ (1 –≥–æ–¥, 5 –ª–µ—Ç, MAX) –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –Ω–∏–º–∏ –∫–æ–¥ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω—ã –∏–∑ –∫–æ–º–∞–Ω–¥—ã `/compare`. –ì—Ä–∞—Ñ–∏–∫ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –±–µ–∑ inline –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–∏–æ–¥–∞, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ Reply Keyboard.

–ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∞–∫—Ç–∏–≤–æ–≤ –∏ –Ω–µ –Ω–∞—Ä—É—à–∞—é—Ç —Ä–∞–±–æ—Ç—É –¥—Ä—É–≥–∏—Ö –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞.
