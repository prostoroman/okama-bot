# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è - –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ HTML

## –ü—Ä–æ–±–ª–µ–º–∞
–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `_send_photo_safe`, —Ç–µ–∫—Å—Ç –ø–æ–¥ –≥—Ä–∞—Ñ–∏–∫–æ–º –≤ –∫–æ–º–∞–Ω–¥–µ `/compare` –≤—Å–µ –µ—â–µ –≤—ã–≤–æ–¥–∏–ª—Å—è –±–µ–∑ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```
üìà –ì—Ä–∞—Ñ–∏–∫ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏

–ê–∫—Ç–∏–≤—ã: SPY.US, QQQ.US
–í–∞–ª—é—Ç–∞: USD

üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫

| –ú–µ—Ç—Ä–∏–∫–∞ | SPY.US | QQQ.US |
|:------|:---:-|:---:-|
| –°—Ä–µ–¥–Ω–µ–≥–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (CAGR) |  10.63%  |  10.31%  |
| –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å |  18.69%  |  27.11%  |
| –ö–æ—ç—Ñ—Ñ. –®–∞—Ä–ø–∞ |  0.46  |  0.31  |
| –ú–∞–∫—Å. –ø—Ä–æ—Å–∞–¥–∫–∞ |  -55.19%  |  -82.98%  |
```

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
1. **Telegram API –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è** - –≤–æ–∑–º–æ–∂–Ω–æ, Markdown –≤ caption –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ —Ç–∞–∫, –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è
2. **–ü—Ä–æ–±–ª–µ–º—ã —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º** - —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ Markdown-—Ç–∞–±–ª–∏—Ü–µ –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
3. **Fallback –º–µ—Ö–∞–Ω–∏–∑–º** - –≤–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç fallback –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –±–µ–∑ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ
–ü–µ—Ä–µ—Ö–æ–¥ —Å Markdown –Ω–∞ HTML –¥–ª—è –ª—É—á—à–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å Telegram API.

## –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_create_enhanced_chart_caption`
**–°—Ç—Ä–æ–∫–∏ 7226-7272** - –ø–µ—Ä–µ—Ö–æ–¥ —Å Markdown –Ω–∞ HTML:

```python
# –ë—ã–ª–æ (Markdown):
chart_title = f"üìà **–ì—Ä–∞—Ñ–∏–∫ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏**"
assets_info = f"**–ê–∫—Ç–∏–≤—ã:** {', '.join(symbols)}"
currency_info = f"**–í–∞–ª—é—Ç–∞:** {currency}"
summary_section = f"üìä **–°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫**"

# –°—Ç–∞–ª–æ (HTML):
chart_title = f"üìà <b>–ì—Ä–∞—Ñ–∏–∫ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏</b>"
assets_info = f"<b>–ê–∫—Ç–∏–≤—ã:</b> {', '.join(symbols)}"
currency_info = f"<b>–í–∞–ª—é—Ç–∞:</b> {currency}"
summary_section = f"üìä <b>–°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫</b>"
```

### 2. –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_convert_markdown_table_to_html`
**–°—Ç—Ä–æ–∫–∏ 7274-7322** - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Markdown-—Ç–∞–±–ª–∏—Ü—ã –≤ HTML:

```python
def _convert_markdown_table_to_html(self, markdown_table: str) -> str:
    """Convert markdown table to HTML table for better Telegram compatibility"""
    # –ü–∞—Ä—Å–∏–Ω–≥ Markdown-—Ç–∞–±–ª–∏—Ü—ã
    # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ HTML-—Ç–∞–±–ª–∏—Ü—É
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∂–∏—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –≤ –ø–µ—Ä–≤–æ–π –∫–æ–ª–æ–Ω–∫–µ
    # Fallback –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `_send_photo_safe`
**–°—Ç—Ä–æ–∫–∞ 3722** - —è–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ HTML:

```python
await self._send_photo_safe(
    update=update,
    photo_bytes=img_bytes,
    caption=self._truncate_caption(caption),
    reply_markup=reply_markup,
    context=context,
    parse_mode='HTML'  # Try HTML instead of Markdown for better compatibility
)
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ HTML –Ω–∞–¥ Markdown

### 1. –õ—É—á—à–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Telegram
- HTML –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ caption
- –ú–µ–Ω—å—à–µ –ø—Ä–æ–±–ª–µ–º —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å–∏–º–≤–æ–ª–æ–≤
- –ë–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### 2. –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
- HTML-—Ç–∞–±–ª–∏—Ü—ã –ª—É—á—à–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ Telegram
- –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å —Å–∏–º–≤–æ–ª–∞–º–∏ `|` –∏ `:`
- –ë–æ–ª–µ–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 3. –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- HTML –ø—Ä–æ—â–µ –ø–∞—Ä—Å–∏—Ç—å –∏ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å
- –ú–µ–Ω—å—à–µ edge cases —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–π fallback

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
üìà –ì—Ä–∞—Ñ–∏–∫ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏

–ê–∫—Ç–∏–≤—ã: SPY.US, QQQ.US
–í–∞–ª—é—Ç–∞: USD

üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫

| –ú–µ—Ç—Ä–∏–∫–∞ | SPY.US | QQQ.US |
|:------|:---:-|:---:-|
| –°—Ä–µ–¥–Ω–µ–≥–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (CAGR) |  10.63%  |  10.31%  |
| –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å |  18.69%  |  27.11%  |
| –ö–æ—ç—Ñ—Ñ. –®–∞—Ä–ø–∞ |  0.46  |  0.31  |
| –ú–∞–∫—Å. –ø—Ä–æ—Å–∞–¥–∫–∞ |  -55.19%  |  -82.98%  |
```

**–° –∂–∏—Ä–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º:**
- üìà **–ì—Ä–∞—Ñ–∏–∫ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏**
- **–ê–∫—Ç–∏–≤—ã:** SPY.US, QQQ.US
- **–í–∞–ª—é—Ç–∞:** USD
- **–°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫**
- **–°—Ä–µ–¥–Ω–µ–≥–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (CAGR)**, **–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å**, –∏ —Ç.–¥.

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã:
1. **–ü—Ä–∏ –æ—à–∏–±–∫–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü—ã** - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è Markdown-—Ç–∞–±–ª–∏—Ü–∞
2. **–ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ–∑–¥–∞–Ω–∏—è caption** - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–∞—è –ø–æ–¥–ø–∏—Å—å
3. **–ü—Ä–∏ –æ—à–∏–±–∫–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ** - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ `_send_message_safe`

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –õ–∏–Ω—Ç–µ—Ä –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–æ–∫
- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- ‚úÖ Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

## –°—Ç–∞—Ç—É—Å
‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ** - –∫–æ–º–∞–Ω–¥–∞ `/compare` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTML-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ª—É—á—à–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å Telegram API.
