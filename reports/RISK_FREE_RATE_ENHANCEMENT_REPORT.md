# –û—Ç—á–µ—Ç –æ–± —É–ª—É—á—à–µ–Ω–∏–∏ —Ä–∞—Å—á–µ—Ç–∞ –±–µ–∑—Ä–∏—Å–∫–æ–≤—ã—Ö —Å—Ç–∞–≤–æ–∫

## üéØ –¶–µ–ª—å
–ó–∞–º–µ–Ω–∏—Ç—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –±–µ–∑—Ä–∏—Å–∫–æ–≤—É—é —Å—Ç–∞–≤–∫—É 2% –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å—Ç–∞–≤–∫–∏, —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞–ª—é—Ç—ã –∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã—Ö –±–∞–Ω–∫–æ–≤.

## üîç –ü—Ä–æ–±–ª–µ–º–∞
–í —Ñ—É–Ω–∫—Ü–∏–∏ `_create_summary_metrics_table` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –±–µ–∑—Ä–∏—Å–∫–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ 2%, —á—Ç–æ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–æ:
- –ê–∫—Ç—É–∞–ª—å–Ω—ã–º —Å—Ç–∞–≤–∫–∞–º —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã—Ö –±–∞–Ω–∫–æ–≤
- –†–∞–∑–ª–∏—á–∏—è–º –º–µ–∂–¥—É –≤–∞–ª—é—Ç–∞–º–∏
- –ü–µ—Ä–∏–æ–¥—É –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏ `get_risk_free_rate`
–í –∫–æ–¥–µ —É–∂–µ –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_risk_free_rate`, –∫–æ—Ç–æ—Ä–∞—è:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã—Ö –±–∞–Ω–∫–æ–≤ —á–µ—Ä–µ–∑ okama
- –£—á–∏—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–∏–æ–¥ –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è RUB –∏ CNY
- –ò–º–µ–µ—Ç fallback —Å—Ç–∞–≤–∫–∏ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

### 2. –ú–∞–ø–ø–∏–Ω–≥ –≤–∞–ª—é—Ç –Ω–∞ –±–µ–∑—Ä–∏—Å–∫–æ–≤—ã–µ —Å—Ç–∞–≤–∫–∏
```python
self.risk_free_rate_mapping = {
    'USD': 'US_EFFR.RATE',  # US Federal Reserve Effective Federal Funds Rate
    'EUR': 'EU_DFR.RATE',   # European Central Bank key rate
    'GBP': 'UK_BR.RATE',    # Bank of England Bank Rate
    'RUB': 'RUS_CBR.RATE',  # Bank of Russia key rate
    'CNY': 'CHN_LPR1.RATE', # China one-year loan prime rate
    'JPY': 'US_EFFR.RATE',  # Use US rate as proxy for JPY
    'CHF': 'EU_DFR.RATE',   # Use EU rate as proxy for CHF
    'CAD': 'US_EFFR.RATE',  # Use US rate as proxy for CAD
    'AUD': 'US_EFFR.RATE',  # Use US rate as proxy for AUD
    'ILS': 'ISR_IR.RATE',   # Bank of Israel interest rate
}
```

### 3. Fallback —Å—Ç–∞–≤–∫–∏ (–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–∞ 2025 –≥–æ–¥)
```python
fallback_rates = {
    'USD': 0.05,  # 5% - current Fed funds rate
    'EUR': 0.04,  # 4% - current ECB rate
    'GBP': 0.05,  # 5% - current BoE rate
    'RUB': 0.16,  # 16% - current CBR rate
    'CNY': 0.035, # 3.5% - current LPR rate
    'JPY': 0.05,  # 5% - use US rate as proxy
    'CHF': 0.04,  # 4% - use EU rate as proxy
    'CAD': 0.05,  # 5% - use US rate as proxy
    'AUD': 0.05,  # 5% - use US rate as proxy
    'ILS': 0.045, # 4.5% - current BoI rate
}
```

## üîß –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –®–∞—Ä–ø–∞
**–ë—ã–ª–æ:**
```python
risk_free_rate = 0.02  # 2% annual risk-free rate
symbol_metrics['sharpe'] = (symbol_metrics['cagr'] - risk_free_rate) / symbol_metrics['volatility']
```

**–°—Ç–∞–ª–æ:**
```python
# Calculate years for period-based rate selection
years = None
if prices is not None and len(prices) > 1:
    start_date = prices.index[0]
    end_date = prices.index[-1]
    if hasattr(start_date, 'to_timestamp'):
        start_date = start_date.to_timestamp()
    if hasattr(end_date, 'to_timestamp'):
        end_date = end_date.to_timestamp()
    years = (end_date - start_date).days / 365.25

# Use proper risk-free rate based on currency
risk_free_rate = self.get_risk_free_rate(currency, years)
symbol_metrics['sharpe'] = (symbol_metrics['cagr'] - risk_free_rate) / symbol_metrics['volatility']
symbol_metrics['risk_free_rate'] = risk_free_rate
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –°–æ—Ä—Ç–∏–Ω–æ
**–ë—ã–ª–æ:**
```python
risk_free_rate = 0.02  # 2% annual risk-free rate
symbol_metrics['sortino'] = (symbol_metrics['cagr'] - risk_free_rate) / downside_deviation
```

**–°—Ç–∞–ª–æ:**
```python
# Use the same risk-free rate as calculated for Sharpe ratio
risk_free_rate = symbol_metrics.get('risk_free_rate', self.get_risk_free_rate(currency))
symbol_metrics['sortino'] = (symbol_metrics['cagr'] - risk_free_rate) / downside_deviation
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–µ–∑—Ä–∏—Å–∫–æ–≤–æ–π —Å—Ç–∞–≤–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
**–ë—ã–ª–æ:**
```python
risk_free_row = ["–ë–µ–∑—Ä–∏—Å–∫–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞"]
for symbol in symbols:
    risk_free_row.append("2.00%")  # Fixed 2% annual risk-free rate
```

**–°—Ç–∞–ª–æ:**
```python
risk_free_row = ["–ë–µ–∑—Ä–∏—Å–∫–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞"]
for symbol in symbols:
    risk_free_rate = metrics_data.get(symbol, {}).get('risk_free_rate')
    if risk_free_rate is not None:
        risk_free_row.append(f"{risk_free_rate*100:.2f}%")
    else:
        risk_free_row.append("N/A")
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ë–µ–∑—Ä–∏—Å–∫–æ–≤—ã–µ —Å—Ç–∞–≤–∫–∏ –ø–æ –≤–∞–ª—é—Ç–∞–º
| –í–∞–ª—é—Ç–∞ | –°–∏–º–≤–æ–ª okama | –°—Ç–∞–≤–∫–∞ | Fallback |
|:-------|:-------------|:-------|:---------|
| USD | US_EFFR.RATE | 5.00% | 5.00% |
| EUR | EU_DFR.RATE | 4.00% | 4.00% |
| GBP | UK_BR.RATE | 5.00% | 5.00% |
| RUB | RUS_CBR.RATE | 16.00% | 16.00% |
| CNY | CHN_LPR1.RATE | 3.50% | 3.50% |
| JPY | US_EFFR.RATE | 5.00% | 5.00% |
| CHF | EU_DFR.RATE | 4.00% | 4.00% |
| CAD | US_EFFR.RATE | 5.00% | 5.00% |
| AUD | US_EFFR.RATE | 5.00% | 5.00% |
| ILS | ISR_IR.RATE | 4.50% | 4.50% |

### –í–ª–∏—è–Ω–∏–µ –Ω–∞ –º–µ—Ç—Ä–∏–∫–∏ SPY.US –∏ QQQ.US
| –ê–∫—Ç–∏–≤ | –°—Ç–∞—Ä–∞—è —Å—Ç–∞–≤–∫–∞ | –ù–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ | –°—Ç–∞—Ä—ã–π Sharpe | –ù–æ–≤—ã–π Sharpe |
|:------|:-------------|:-------------|:-------------|:-------------|
| SPY.US | 2.00% | 5.00% | 0.46 | 0.30 |
| QQQ.US | 2.00% | 5.00% | 0.31 | 0.20 |

## üìà –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –º–µ—Ç—Ä–∏–∫

| –ú–µ—Ç—Ä–∏–∫–∞                         | SPY.US   | QQQ.US   |
|:--------------------------------|:---------|:---------|
| –°—Ä–µ–¥–Ω–µ–≥–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (CAGR) | 10.63%   | 10.31%   |
| –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å                   | 18.69%   | 27.11%   |
| **–ë–µ–∑—Ä–∏—Å–∫–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞**          | **5.00%**| **5.00%**|
| –ö–æ—ç—Ñ—Ñ. –®–∞—Ä–ø–∞                    | 0.30     | 0.20     |
| –ú–∞–∫—Å. –ø—Ä–æ—Å–∞–¥–∫–∞                  | -55.19%  | -82.98%  |
| –ö–æ—ç—Ñ. –°–æ—Ä—Ç–∏–Ω–æ                   | 7.10     | 4.10     |
| –ö–æ—ç—Ñ. –ö–∞–ª—å–º–∞—Ä–∞                  | 0.19     | 0.12     |
| VaR 95%                         | -1.81%   | -2.75%   |
| CVaR 95%                        | -2.80%   | -4.05%   |

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

### 1. –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã—Ö –±–∞–Ω–∫–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞–≤–æ–∫
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–µ–∫—É—â–∏–º —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–º —É—Å–ª–æ–≤–∏—è–º

### 2. –¢–æ—á–Ω–æ—Å—Ç—å
- –£—á–µ—Ç —Ä–∞–∑–ª–∏—á–∏–π –º–µ–∂–¥—É –≤–∞–ª—é—Ç–∞–º–∏
- –ü–µ—Ä–∏–æ–¥-–∑–∞–≤–∏—Å–∏–º—ã–π –≤—ã–±–æ—Ä —Å—Ç–∞–≤–æ–∫ –¥–ª—è RUB –∏ CNY
- –ë–æ–ª–µ–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –®–∞—Ä–ø–∞ –∏ –°–æ—Ä—Ç–∏–Ω–æ

### 3. –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –±–µ–∑—Ä–∏—Å–∫–æ–≤–æ–π —Å—Ç–∞–≤–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–ª–∏—è–Ω–∏—è —Å—Ç–∞–≤–∫–∏ –Ω–∞ –º–µ—Ç—Ä–∏–∫–∏
- –ü–æ–Ω—è—Ç–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 4. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- Fallback –º–µ—Ö–∞–Ω–∏–∑–º –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ okama –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–±–æ—Ä–∞ —Å—Ç–∞–≤–∫–∏

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –≤–Ω–µ–¥—Ä–µ–Ω—ã
- –ó–∞–º–µ–Ω–µ–Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞–≤–∫–∞ 2% –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å—Ç–∞–≤–∫–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è `get_risk_free_rate`
- –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ä–∞—Å—á–µ—Ç—ã –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –®–∞—Ä–ø–∞ –∏ –°–æ—Ä—Ç–∏–Ω–æ
- –î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç–∞–≤–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ

### üìä –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –®–∞—Ä–ø–∞ –∏ –°–æ—Ä—Ç–∏–Ω–æ —Å—Ç–∞–ª–∏ –±–æ–ª–µ–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–º–∏
- –≠—Ç–æ –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è —Å –≤—ã—Å–æ–∫–∏–º–∏ —Å—Ç–∞–≤–∫–∞–º–∏
- –ú–µ—Ç—Ä–∏–∫–∏ —Å—Ç–∞–ª–∏ –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–º–∏ –∏ —Å–æ–ø–æ—Å—Ç–∞–≤–∏–º—ã–º–∏

### üîÑ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å fallback —Å—Ç–∞–≤–∫–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å okama –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å—Ç–∞–≤–∫–∞–º
- –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –≤–∞–ª—é—Ç –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---
*–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω: 2025-01-27*  
*–°—Ç–∞—Ç—É—Å: –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í–ù–ï–î–†–ï–ù–´ –£–°–ü–ï–®–ù–û*  
*–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ü–†–û–î–û–õ–ñ–ò–¢–¨ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –ù–û–í–û–ì–û –ü–û–î–•–û–î–ê*
