# –û—Ç—á–µ—Ç –æ–± —É–ª—É—á—à–µ–Ω–∏–∏ –∫–Ω–æ–ø–∫–∏ –ú–µ—Ç—Ä–∏–∫–∏ –≤ –∫–æ–º–∞–Ω–¥–µ /compare

## üéØ –¶–µ–ª—å
–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É Metrics –≤ –ú–µ—Ç—Ä–∏–∫–∏, –∏–∑–º–µ–Ω–∏—Ç—å –µ–µ –ª–æ–≥–∏–∫—É –¥–ª—è –≤—ã–≤–æ–¥–∞ —Ç–∞–±–ª–∏—Ü—ã –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫, –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ç–∞–±–ª–∏—Ü—É –∏–∑ –ø–æ–¥–ø–∏—Å–∏ –≥—Ä–∞—Ñ–∏–∫–∞ –≤ –∫–Ω–æ–ø–∫—É, –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ —É–ª—É—á—à–∏—Ç—å –ø–æ–¥–ø–∏—Å—å –∫ –≥—Ä–∞—Ñ–∏–∫—É.

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ Metrics –≤ –ú–µ—Ç—Ä–∏–∫–∏
- **–§–∞–π–ª**: `bot.py`, —Å—Ç—Ä–æ–∫–∏ 3748 –∏ 7433
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è**: 
  - –í —Ñ—É–Ω–∫—Ü–∏–∏ `compare_command`: `InlineKeyboardButton("üìä Metrics", callback_data="metrics_compare")` ‚Üí `InlineKeyboardButton("üìä –ú–µ—Ç—Ä–∏–∫–∏", callback_data="metrics_compare")`
  - –í —Ñ—É–Ω–∫—Ü–∏–∏ `_create_compare_command_keyboard`: –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ö–Ω–æ–ø–∫–∞ —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∫–Ω–æ–ø–∫–∏ –ú–µ—Ç—Ä–∏–∫–∏
- **–§–∞–π–ª**: `bot.py`, —Å—Ç—Ä–æ–∫–∏ 6185-6231
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è**: –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_handle_metrics_compare_button`
- **–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞**:
  - –í–º–µ—Å—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Excel —Ñ–∞–π–ª —Ç–µ–ø–µ—Ä—å –≤—ã–≤–æ–¥–∏—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ –º–µ—Ç—Ä–∏–∫ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `_create_summary_metrics_table` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
  - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**: –ë–æ–ª–µ–µ –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –º–µ—Ç—Ä–∏–∫–∞–º –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞

### 3. –ü–µ—Ä–µ–Ω–æ—Å —Ç–∞–±–ª–∏—Ü—ã –∏–∑ –ø–æ–¥–ø–∏—Å–∏ –≥—Ä–∞—Ñ–∏–∫–∞ –≤ –∫–Ω–æ–ø–∫—É –ú–µ—Ç—Ä–∏–∫–∏
- **–§–∞–π–ª**: `bot.py`, —Å—Ç—Ä–æ–∫–∏ 3709-3714 –∏ 3796-3797
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
  - –£–¥–∞–ª–µ–Ω –≤—ã–∑–æ–≤ `_create_summary_metrics_table` –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
  - –£–¥–∞–ª–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –ø–æ—Å–ª–µ –≥—Ä–∞—Ñ–∏–∫–∞
  - –¢–∞–±–ª–∏—Ü–∞ —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –ú–µ—Ç—Ä–∏–∫–∏
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ë–æ–ª–µ–µ —á–∏—Å—Ç–∞—è –ø–æ–¥–ø–∏—Å—å –∫ –≥—Ä–∞—Ñ–∏–∫—É, —Ç–∞–±–ª–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é

### 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ –≤ —Ç–∞–±–ª–∏—Ü—É
- **–§–∞–π–ª**: `bot.py`, —Å—Ç—Ä–æ–∫–∏ 7305-7363 –∏ 7412-7450
- **–ù–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏**:
  - **–ö–æ—ç—Ñ. –°–æ—Ä—Ç–∏–Ω–æ**: –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –°–æ—Ä—Ç–∏–Ω–æ (–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∏–∑–±—ã—Ç–æ—á–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∫ downside deviation)
  - **–ö–æ—ç—Ñ. –ö–∞–ª—å–º–∞—Ä–∞**: –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ö–∞–ª—å–º–∞—Ä–∞ (–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –≥–æ–¥–æ–≤–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ—Å–∞–¥–∫–µ)
  - **VaR 95%**: Value at Risk –Ω–∞ —É—Ä–æ–≤–Ω–µ 95% (5-–π –ø—Ä–æ—Ü–µ–Ω—Ç–∏–ª—å –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏)
  - **CVaR 95%**: Conditional Value at Risk –Ω–∞ —É—Ä–æ–≤–Ω–µ 95% (–æ–∂–∏–¥–∞–µ–º–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –Ω–∏–∂–µ VaR 95%)
- **–†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫**:
  - Sortino: `(CAGR - risk_free_rate) / downside_deviation`
  - Calmar: `CAGR / abs(max_drawdown)`
  - VaR 95%: `returns.quantile(0.05)`
  - CVaR 95%: `returns[returns <= var_95].mean()`

### 5. –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤—ã–≥—Ä—É–∑–∫–∏ –≤ Excel
- **–§–∞–π–ª**: `bot.py`, —Å—Ç—Ä–æ–∫–∏ 6837-7169 –∏ 7243-7471
- **–£–¥–∞–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
  - `_prepare_comprehensive_metrics`: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Excel —ç–∫—Å–ø–æ—Ä—Ç–∞
  - `_create_metrics_excel`: –°–æ–∑–¥–∞–Ω–∏–µ Excel —Ñ–∞–π–ª–∞ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –£–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–¥–∞, —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### 6. –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏ –∫ –≥—Ä–∞—Ñ–∏–∫—É –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
- **–§–∞–π–ª**: `bot.py`, —Å—Ç—Ä–æ–∫–∏ 7207-7274
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
  - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_create_enhanced_chart_caption` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –∞–∫—Ç–∏–≤–æ–≤
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `expanded_symbols` –∏ `portfolio_contexts`
  - –ê–∫—Ç–∏–≤—ã —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ —Å–ø–∏—Å–∫–∞ —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏
  - –ö–∞–∂–¥—ã–π –∞–∫—Ç–∏–≤ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ (‚Ä¢)
- **–§–æ—Ä–º–∞—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è**:
  ```
  üìà –ì—Ä–∞—Ñ–∏–∫ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
  
  –ê–∫—Ç–∏–≤—ã:
  ‚Ä¢ SPY.US (SPDR S&P 500 ETF Trust)
  ‚Ä¢ QQQ.US (Invesco QQQ Trust)
  
  –í–∞–ª—é—Ç–∞: USD
  –ü–µ—Ä–∏–æ–¥: 5Y (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)
  ```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã –º–µ—Ç—Ä–∏–∫

–¢–∞–±–ª–∏—Ü–∞ —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏:

| –ú–µ—Ç—Ä–∏–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| –°—Ä–µ–¥–Ω–µ–≥–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (CAGR) | –ì–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å |
| –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ |
| –ö–æ—ç—Ñ—Ñ. –®–∞—Ä–ø–∞ | –û—Ç–Ω–æ—à–µ–Ω–∏–µ –∏–∑–±—ã—Ç–æ—á–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∫ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ |
| –ú–∞–∫—Å. –ø—Ä–æ—Å–∞–¥–∫–∞ | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ |
| –ö–æ—ç—Ñ. –°–æ—Ä—Ç–∏–Ω–æ | –û—Ç–Ω–æ—à–µ–Ω–∏–µ –∏–∑–±—ã—Ç–æ—á–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∫ downside deviation |
| –ö–æ—ç—Ñ. –ö–∞–ª—å–º–∞—Ä–∞ | –û—Ç–Ω–æ—à–µ–Ω–∏–µ –≥–æ–¥–æ–≤–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ—Å–∞–¥–∫–µ |
| VaR 95% | Value at Risk –Ω–∞ —É—Ä–æ–≤–Ω–µ 95% |
| CVaR 95% | Conditional Value at Risk –Ω–∞ —É—Ä–æ–≤–Ω–µ 95% |

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –í—Å–µ —Ä–∞—Å—á–µ—Ç—ã –º–µ—Ç—Ä–∏–∫ –æ–±–µ—Ä–Ω—É—Ç—ã –≤ try-catch –±–ª–æ–∫–∏
- –ü—Ä–∏ –æ—à–∏–±–∫–µ —Ä–∞—Å—á–µ—Ç–∞ –º–µ—Ç—Ä–∏–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è "N/A"
- Fallback –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Å–ª—É—á–∞–µ–≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –£–¥–∞–ª–µ–Ω—ã —Ç—è–∂–µ–ª—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ Excel —ç–∫—Å–ø–æ—Ä—Ç–∞
- –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –º–µ—Ç—Ä–∏–∫
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ä–∞—Å—á–µ—Ç—ã –º–µ—Ç—Ä–∏–∫

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
- –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —á–∞—Å—Ç–∏ –∫–æ–¥–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –∫–æ–º–∞–Ω–¥–∞ `/compare` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

1. **–ì—Ä–∞—Ñ–∏–∫ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏** –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å—å—é, —Å–æ–¥–µ—Ä–∂–∞—â–µ–π –Ω–∞–∑–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–æ–≤ –∏ –ø–µ—Ä–∏–æ–¥ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
2. **–ö–Ω–æ–ø–∫–∞ "üìä –ú–µ—Ç—Ä–∏–∫–∏"** –≤—ã–≤–æ–¥–∏—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É —Å 8 –∫–ª—é—á–µ–≤—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
3. **–¢–∞–±–ª–∏—Ü–∞ –º–µ—Ç—Ä–∏–∫** –±–æ–ª—å—à–µ –Ω–µ –∑–∞—Å–æ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å –∫ –≥—Ä–∞—Ñ–∏–∫—É
4. **–ù–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –±–æ–ª–µ–µ –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É —Ä–∏—Å–∫–æ–≤ –∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
5. **–£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∫–æ–¥** –±–µ–∑ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π Excel —ç–∫—Å–ø–æ—Ä—Ç–∞

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫.
