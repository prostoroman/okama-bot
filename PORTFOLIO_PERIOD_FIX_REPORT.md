# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ —Å Period –æ–±—ä–µ–∫—Ç–∞–º–∏ –≤ –∫–æ–º–∞–Ω–¥–µ /portfolio

## üêõ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ–∑–¥–∞—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—å —Å —Ä–æ—Å—Å–∏–π—Å–∫–∏–º–∏ –∞–∫—Ü–∏—è–º–∏ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è: float() argument must be a string or a real number, not 'Period'
```

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏–≤–æ–¥–∏–ª–∞ –∫ —Ç–æ–º—É, —á—Ç–æ –∫–æ–º–∞–Ω–¥–∞ `/portfolio SBER.MOEX:0.4 GAZP.MOEX:0.3 LKOH.MOEX:0.3` –Ω–µ –º–æ–≥–ª–∞ —Å–æ–∑–¥–∞—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—å.

## üîç –ü—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏

–ü—Ä–æ–±–ª–µ–º–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –≤ –º–µ—Ç–æ–¥–µ `portfolio_command` –≤ `bot.py`:

1. **Period –æ–±—ä–µ–∫—Ç—ã**: Okama library –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞—Ç—ã –∫–∞–∫ –æ–±—ä–µ–∫—Ç—ã `pandas.Period`
2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –ö–æ–¥ –ø—ã—Ç–∞–ª—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Period` –æ–±—ä–µ–∫—Ç—ã –Ω–∞–ø—Ä—è–º—É—é –≤ `str()` –∏ –¥—Ä—É–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
3. **–û—à–∏–±–∫–∞ float()**: –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `Period` –≤ —á–∏—Å–ª–æ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞

### –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–µ—Å—Ç–∞:
- `portfolio.first_date` –∏ `portfolio.last_date` - –æ–±—ä–µ–∫—Ç—ã `Period`
- `portfolio.period_length` - –º–æ–∂–µ—Ç –±—ã—Ç—å `Period` –æ–±—ä–µ–∫—Ç–æ–º
- –ü–æ–ø—ã—Ç–∫–∏ –ø—Ä—è–º–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å—Ç—Ä–æ–∫–∞—Ö –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—è

#### –î–æ–±–∞–≤–ª–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ first_date –∏ last_date:
```python
# Safely get first and last dates
try:
    first_date = portfolio.first_date
    last_date = portfolio.last_date
    
    # Handle Period objects and other date types
    if hasattr(first_date, 'strftime'):
        first_date_str = first_date.strftime('%Y-%m-%d')
    elif hasattr(first_date, 'to_timestamp'):
        first_date_str = first_date.to_timestamp().strftime('%Y-%m-%d')
    else:
        first_date_str = str(first_date)
    
    if hasattr(last_date, 'strftime'):
        last_date_str = last_date.strftime('%Y-%m-%d')
    elif hasattr(last_date, 'to_timestamp'):
        last_date_str = last_date.to_timestamp().strftime('%Y-%m-%d')
    else:
        last_date_str = str(last_date)
    
    portfolio_text += f"üìÖ –ü–µ—Ä–∏–æ–¥: {first_date_str} - {last_date_str}\n"
except Exception as e:
    self.logger.warning(f"Could not get portfolio dates: {e}")
    portfolio_text += "üìÖ –ü–µ—Ä–∏–æ–¥: –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω\n"
```

#### –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ period_length:
```python
# Safely get period length
try:
    period_length = portfolio.period_length
    
    if hasattr(period_length, 'strftime'):
        # If it's a datetime-like object
        period_length_str = str(period_length)
    elif hasattr(period_length, 'days'):
        # If it's a timedelta-like object
        period_length_str = str(period_length)
    elif hasattr(period_length, 'to_timestamp'):
        # If it's a Period object
        period_length_str = str(period_length)
    else:
        # Try to convert to string directly
        period_length_str = str(period_length)
    
    portfolio_text += f"‚è±Ô∏è –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {period_length_str}\n\n"
except Exception as e:
    self.logger.warning(f"Could not get period length: {e}")
    portfolio_text += "‚è±Ô∏è –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞\n\n"
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞—Ç

#### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã:
- **datetime –æ–±—ä–µ–∫—Ç—ã**: `strftime('%Y-%m-%d')`
- **Period –æ–±—ä–µ–∫—Ç—ã**: `to_timestamp().strftime('%Y-%m-%d')`
- **timedelta –æ–±—ä–µ–∫—Ç—ã**: `str()` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- **–î—Ä—É–≥–∏–µ —Ç–∏–ø—ã**: Fallback —á–µ—Ä–µ–∑ `str()`

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
- **Graceful degradation**: –ï—Å–ª–∏ –¥–∞—Ç–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- **Fallback**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```
/portfolio SBER.MOEX:0.4 GAZP.MOEX:0.3 LKOH.MOEX:0.3
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ü–æ—Ä—Ç—Ñ–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –î–∞—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD
- ‚úÖ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–∏–æ–¥–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ —Å Period –æ–±—ä–µ–∫—Ç–∞–º–∏

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ Period –æ–±—ä–µ–∫—Ç–æ–≤:
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞**: `hasattr(obj, 'to_timestamp')`
- **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è**: `obj.to_timestamp().strftime('%Y-%m-%d')`
- **Fallback**: `str(obj)` –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
- **Try-catch –±–ª–æ–∫–∏**: –ö–∞–∂–¥—ã–π —Ç–∏–ø –¥–∞—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–±–æ—è—Ö
- **Graceful degradation**: –ü–æ–∫–∞–∑ "–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω" –≤–º–µ—Å—Ç–æ –ø–∞–¥–µ–Ω–∏—è

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞—Ç:
- **Period**: `2025-08-01` ‚Üí `2025-08-01 00:00:00`
- **datetime**: `2025-08-01 00:00:00` ‚Üí `2025-08-01`
- **timedelta**: `365 days` ‚Üí `365 days`

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### GitHub:
- **–ö–æ–º–º–∏—Ç**: `12f4815` - "Fix Period object handling in portfolio command - resolve float() error"
- **–§–∞–π–ª—ã**: `bot.py` –æ–±–Ω–æ–≤–ª–µ–Ω
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ `origin/main`

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:
- **–î–æ–±–∞–≤–ª–µ–Ω–æ**: 52 —Å—Ç—Ä–æ–∫–∏ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ Period –æ–±—ä–µ–∫—Ç–æ–≤
- **–£–¥–∞–ª–µ–Ω–æ**: 7 —Å—Ç—Ä–æ–∫ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞
- **–û–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: +45 —Å—Ç—Ä–æ–∫ (—É–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)

## üìã –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–ü–†–û–ë–õ–ï–ú–ê –° PERIOD –û–ë–™–ï–ö–¢–ê–ú–ò –ò–°–ü–†–ê–í–õ–ï–ù–ê** ‚úÖ

- ‚úÖ –û—à–∏–±–∫–∞ "float() argument must be a string or a real number, not 'Period'" —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ Period –æ–±—ä–µ–∫—Ç–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞—Ç
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ö–æ–¥ –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ GitHub

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö:
1. `/portfolio SBER.MOEX:0.4 GAZP.MOEX:0.3 LKOH.MOEX:0.3` - —Ä–æ—Å—Å–∏–π—Å–∫–∏–π –ø–æ—Ä—Ç—Ñ–µ–ª—å
2. `/portfolio SPY.US:0.6 QQQ.US:0.4` - –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–π –ø–æ—Ä—Ç—Ñ–µ–ª—å
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–±–ª–µ–º

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –í–æ–∑–º–æ–∂–Ω—ã–µ –±—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π**: –ò–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è
2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–æ–≤ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø–æ—Ä—Ç—Ñ–µ–ª—è

## üìù –°–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –±—ã–ª–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø—Ä–æ–±–ª–µ–º–æ–π "int too big to convert" –≤ –≥—Ä–∞—Ñ–∏–∫–∞—Ö —Ü–µ–Ω:
- **–û–±—â–∞—è –ø—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –æ—Ç okama library
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ —Ç–∏–ø–æ–≤ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
- **–°—Ç–∞—Ç—É—Å**: –û–±–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã ‚úÖ

–û—à–∏–±–∫–∞ —Å Period –æ–±—ä–µ–∫—Ç–∞–º–∏ –≤ –∫–æ–º–∞–Ω–¥–µ /portfolio —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞! üéØüìä‚ú®
